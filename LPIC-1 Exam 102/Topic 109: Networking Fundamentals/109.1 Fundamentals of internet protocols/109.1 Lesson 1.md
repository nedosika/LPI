# 109.1 Урок 1

| **Сертификат:** | LPIC-1                                      |
|:----------------|:--------------------------------------------|
| **Версия:**     | 5.0                                         |
| **Тема:**       | 109 Основы сетевых технологий               |                           
| **Цель:**       | 109.1 Основы интернет-протоколов            |
| **Урок:**       | 1 из 2                                      |


## Введение

TCP/IP (*протокол управления передачей/Интернет-протокол*) - это стек протоколов, используемых для обеспечения связи между компьютерами. Несмотря на название, стек состоит из нескольких протоколов, таких как IP, TCP, UDP, ICMP, DNS, SMTP, ARP и других.


## IP (Internet Protocol)

IP - это протокол, отвечающий за логическую адресацию хоста, позволяющий отправлять пакет с одного хоста на другой. Для этого каждому устройству в сети назначается уникальный IP-адрес, и одному устройству можно назначить более одного адреса. 

В версии 4 протокола IP, обычно называемой IPv4, адрес формируется набором из 32 бит, разделенных на 4 группы по 8 бит, представленных в десятичной форме, называемых «пунктирным квадратом». Например: 

Двоичный формат (4 группы по 8 бит)  
`11000000.10101000.00001010.00010100` 

Десятичный формат  
`192.168.10.20`

В IPv4 значения для каждого октета могут находиться в диапазоне от 0 до 255, что эквивалентно 11111111 в двоичном формате.


## Классификация адресов

Теоретически IP-адреса разделяются по классам, которые определяются диапазоном первого октета, как показано в таблице ниже:

| Класс | Первый октект | Диапазон                    | Пример         |
|:------|:--------------|:----------------------------|:---------------|
| A     | 1-126         | `1.0.0.0`–`126.255.255.255` | `10.25.13.10`  |
| B     | 128-191       |`128.0.0.0`-`191.255.255.255`| `141.150.200.1`|                         
| C     | 192-223       |`192.0.0.0`–`223.255.255.255`|`200.178.12.242`|


## Публичные и частные IP-адреса

Как упоминалось ранее, для установления связи каждое устройство в сети должно быть связано как минимум с одним уникальным IP-адресом. Однако, если бы каждое устройство в мире, подключенное к Интернету, имело уникальный IP-адрес, не хватило бы IP-адресов (v4) для всех. Для этого были определены *частные* IP-адреса. 

Частные IP-адреса - это диапазоны IP-адресов, которые были зарезервированы для использования во внутренних (частных) сетях компаний, учреждений, домов и т. д. В пределах одной сети использование IP-адреса остается уникальным. Однако один и тот же частный IP-адрес можно использовать в любой частной сети. 

Таким образом, в Интернете у нас есть трафик данных с использованием общедоступных IP-адресов, которые распознаются и маршрутизируются через Интернет, тогда как в частных сетях используются эти зарезервированные диапазоны IP-адресов. Маршрутизатор отвечает за преобразование трафика из частной сети в общедоступную и наоборот. 

Диапазоны частных IP-адресов, разделенные по классам, можно увидеть в таблице ниже:

| Класс | Первый октект | Диапазон                    | Частные IP-адреса             |
|:------|:--------------|:----------------------------|:------------------------------|
| A     | 1-126         |`1.0.0.0`–`126.255.255.255`  |`10.0.0.0`-`10.255.255.255`    |
| B     | 128-191       |`128.0.0.0`-`191.255.255.255`|`172.16.0.0`–`172.31.255.255`  |
| C     | 192-223       |`192.0.0.0`–`223.255.255.255`|`192.168.0.0`–`192.168.255.255`|


## Преобразование из десятичного формата в двоичный

Для субъектов этой темы важно знать, как конвертировать IP-адреса между двоичным и десятичным форматами. 

Преобразование из десятичного формата в двоичный выполняется последовательным делением на 2. В качестве примера давайте преобразуем значение 105, выполнив следующие действия: 

1. Разделив значение 105 на 2, получим:
```console
105/2
Quotient = 52
Rest = 1
```

2. Разделите частное последовательно на 2, пока частное не станет равным 1:
```console
52/2
Rest = 0
Quotient = 26
```
```console
26/2
Rest = 0
Quotient = 13
```
```console
13/2
Rest = 1
Quotient = 6
```
```console
6/2
Rest = 0
Quotient = 3
```
```console
3/2
Rest = 1
Quotient = 1
```

3. Сгруппируйте последнее частное, а затем оставшиеся от всех подразделений:
```console
1101001
```

4. Заполните нули слева, пока не будут заполнены 8 бит:
```console
01101001
```

5. В итоге мы имеем, что значение 105 в десятичной системе счисления равно 01101001 в двоичной системе счисления.


## Преобразование из двоичного формата в десятичный

В этом примере мы будем использовать двоичное значение `10110000`. 

1. Каждый бит связан со значением с базовой степенью двойки. Мощности начинаются с 0 и увеличиваются справа налево. В этом примере у нас будет:

| 1           | 0           | 1           | 1           | 0           | 0           | 0           | 0           |
|:------------|:------------|:------------|:------------|:------------|:------------|:------------|:------------|
|2<sup>7</sup>|2<sup>6</sup>|2<sup>5</sup>|2<sup>4</sup>|2<sup>3</sup>|2<sup>2</sup>|2<sup>1</sup>|2<sup>0</sup>|

2. Когда бит равен 1, мы присваиваем значение соответствующей мощности, когда бит равен 0, результат равен 0.

| 1           | 0           | 1           | 1           | 0           | 0           | 0           | 0           |
|:------------|:------------|:------------|:------------|:------------|:------------|:------------|:------------|
|2<sup>7</sup>|2<sup>6</sup>|2<sup>5</sup>|2<sup>4</sup>|2<sup>3</sup>|2<sup>2</sup>|2<sup>1</sup>|2<sup>0</sup>|
| 128         | 0           | 32          | 16          | 0           | 0           | 0           | 0           |

3. Сложите все значения:
128 + 32 + 16 = 176

4. Таким образом, 10110000 в двоичном формате равно 176 в десятичном.


## Маска сети

Сетевая маска (или *сетевая маска*) используется вместе с IP-адресом, чтобы определить, какая часть IP представляет сеть, а какая - хосты. Он имеет тот же формат, что и IP-адрес, то есть 32 бита разделены на 4 группы по 8. Например:

| Десятичный    | Двоичный                            | CIDR |
|:--------------|:------------------------------------|:-----|
|`255.0.0.0`    |`11111111.00000000.00000000.00000000`| `8`  |
|`255.255.0.0`  |`11111111.11111111.00000000.00000000`| `16` |
|`255.255.255.0`|`11111111.11111111.11111111.00000000`| `24` |

Используя в качестве примера маску `255.255.0.0`, она указывает, что в связанном с ней IP-адресе первые 16 бит (2 первых десятичных знака) идентифицируют сеть/подсеть, а последние 16 бит используются для однозначной идентификации хостов в сети. 

Упомянутая выше CIDR (*бесклассовая междоменная маршрутизация*) связана с упрощенной нотацией маски, которая указывает количество битов (1), связанных с сетью/подсетью. Это обозначение обычно используется для замены десятичного формата, например `/24` вместо `255.255.255.0`. 

Интересно отметить, что каждый класс IP имеет стандартную маску, а именно:

| Класс | Первый октект | Диапазон                    | Маска по умолчанию |
|:------|:--------------|:----------------------------|:-------------------|
| A     | 1-126         |`1.0.0.0`–`126.255.255.255`  |`255.0.0.0/8`       |
| B     | 128-191       |`128.0.0.0`-`191.255.255.255`|`255.255.0.0/16`    |
| C     | 192-223       |`192.0.0.0`–`223.255.255.255`|`255.255.255.0/24`  |

Однако этот шаблон не означает, что это маска, которая будет использоваться всегда. Можно использовать любую маску с любым IP-адресом, как мы увидим ниже. 

Вот несколько примеров использования IP-адресов и масок:

```console
192.168.8.12 / 255.255.255.0 / 24
```

Диапазон  
`192.168.8.0`-`192.168.8.255` 

Адрес сети  
`192.168.8.0` 

Широковещательный адрес  
`192.168.8.255`

Хосты  
`192.168.8.1`-`192.168.8.254` 

В этом случае у нас есть первые 3 цифры (первые 24 бита) IP-адреса, определяющие сеть, а последняя цифра идентифицирует адреса хостов, то есть диапазон этой сети идет от `192.168.8.0` до `192.168.8.255`. 

Теперь у нас есть две важные концепции: каждая сеть/подсеть имеет 2 зарезервированных адреса, первый адрес в диапазоне называется *адресом сети*. В данном случае `192.168.8.0`, который используется для идентификации самой сети/подсети. Последний адрес в диапазоне называется *широковещательным адресом*, в данном случае `192.168.8.255`. 

Этот адрес назначения используется для отправки одного и того же сообщения (пакета) на все IP-узлы в этой сети/подсети. Сетевые и широковещательные адреса не могут использоваться машинами в сети. Таким образом, список IP-адресов, которые можно эффективно настроить, варьируется от `192.168.8.1` до `192.168.8.254`. 

Теперь пример того же IP, но с другой маской:

```console
192.168.8.12 / 255.255.0.0 / 16
```

Диапазон  
`192.168.0.0`-`192.168.255.255` 

Адрес сети  
`192.168.0.0` 

Широковещательный адрес  
`192.168.255.255`  

Хосты  
`192.168.0.1`-`192.168.255.254` 

Посмотрите, как разные маски изменяют диапазон IP-адресов, находящихся в одной сети/подсети. 

Разделение сетей по маскам не ограничивается значениями по умолчанию (8, 16, 24). Мы можем создавать подразделения по желанию, добавляя или удаляя биты в сетевой идентификации, создавая новые подсети. 

Например:

```console
11111111.11111111.11111111.00000000 = 255.255.255.0 = 24
```

Если мы хотим разделить сеть выше на 2, просто добавьте еще один бит к идентификатору сети в маске, например:

```console
11111111.11111111.11111111.10000000 = 255.255.255.128 = 25
```

У нас есть следующие подсети:

```
192.168.8.0   - 192.168.8.127
192.168.8.128 - 192.168.8.255
```

Если мы еще больше увеличим подразделение сети:

```console
11111111.11111111.11111111.11000000 = 255.255.255.192 = 26
```

Мы будем иметь:

```console
192.168.8.0   - 192.168.8.63
192.168.8.64  - 192.168.8.127
192.168.8.128 - 192.168.8.191
192.168.8.192 - 192.168.8.255
```

Обратите внимание, что в каждой подсети у нас будет зарезервированный сетевой (первый в диапазоне) и широковещательный (последний в диапазоне) адреса, поэтому чем больше сеть разделена, тем меньше IP-адресов может эффективно использоваться хостами.


## Определение сетевых и широковещательных адресов

С помощью IP-адреса и маски мы можем идентифицировать сетевой адрес и широковещательный адрес и, таким образом, определить диапазон IP-адресов для сети/подсети. 

Сетевой адрес получается с помощью «логического И» между IP-адресом и маской в их двоичных форматах. Возьмем пример с IP `192.168.8.12` и маской `255.255.255.192`. 

Преобразование из десятичного в двоичный формат, как мы видели ранее, мы имеем:

```console
11000000.10101000.00001000.00001100 (192.168.8.12)
11111111.11111111.11111111.11000000 (255.255.255.192)
```

С «логическим И» мы имеем 1 и 1 = 1, 0 и 0 = 0, 1 и 0 = 0, поэтому:

```console
11000000.10101000.00001000.00001100 (192.168.8.12)
11111111.11111111.11111111.11000000 (255.255.255.192)
11000000.10101000.00001000.00000000
```

Таким образом, сетевой адрес для этой подсети - `192.168.8.0`. Теперь, чтобы получить широковещательный адрес, мы должны использовать сетевой адрес, где все биты, относящиеся к адресу хоста, равны 1:

```console
11000000.10101000.00001000.00000000 (192.168.8.0)
11111111.11111111.11111111.11000000 (255.255.255.192)
11000000.10101000.00001000.00111111
```

Тогда широковещательный адрес `192.168.8.63`. 

В заключение имеем:

```console
192.168.8.12 / 255.255.255.192 / 26
```

Диапазон  
`192.168.8.0`-`192.168.8.63` 

Сетевой адрес  
`192.168.8.0` 

Адрес трансляции  
`192.168.8.63` 

Хосты  
`192.168.8.1`-`192.168.8.62`


## Маршрут по умолчанию

Как мы уже видели, машины, находящиеся в одной логической сети/подсети, могут связываться напрямую через протокол IP. 

Но давайте рассмотрим пример ниже: 

Сеть 1  
`192.168.10.0/24` 

Сеть 2  
`192.168.200.0/24` 

В этом случае машина `192.168.10.20` не может напрямую отправить пакет на `192.168.200.100`, поскольку они находятся в разных логических сетях. 

Для обеспечения этой связи используется маршрутизатор (или набор маршрутизаторов). Маршрутизатор в этой конфигурации также можно назвать шлюзом, поскольку он обеспечивает шлюз между двумя сетями. Это устройство имеет доступ к обеим сетям, так как оно настроено с IP-адресами из обеих сетей. Например, `192.168.10.1` и `192.168.200.1`, и по этой причине ему удается быть посредником в этой коммуникации. 

Для этого на каждом узле сети должен быть настроен так называемый маршрут по умолчанию. Маршрут по умолчанию указывает IP-адрес, на который должны быть отправлены все пакеты, адресатом которых является IP-адрес, не являющийся частью логической сети хоста. В приведенном выше примере маршрутом по умолчанию для машин в сети `192.168.10.0/24` будет IP `192.168.10.1`, который является IP-адресом маршрутизатора/шлюза, а маршрутом по умолчанию для машин в сети `192.168.200.0/24` будет `192.168.200.1`. 

Маршрут по умолчанию также используется, чтобы машины в частной сети (LAN) имели доступ к Интернету (WAN) через маршрутизатор.


# Упражнения для закрепления

1. Используя IP-адрес `172.16.30.230` и сетевую маску `255.255.255.224`, определите:

| Обозначение CIDR для сетевой маски |                                          |
|:-----------------------------------|:-----------------------------------------|
| Адрес сети                         |                                          |
| Широковещательный адрес            |                                          |
| Количество IP-адресов, которые можно использовать для хостов в этой подсети | |

2. Какая настройка требуется на хосте, чтобы разрешить IP-связь с хостом в другой логической сети?


## Упражнения на размышление

1. Почему диапазоны IP-адресов, начинающиеся со `127`, и диапазон после `224`, не включены в классы IP-адресов A, B или C? 

2. Одним из очень важных полей, принадлежащих IP-пакету, является TTL (*Time To Live*). Какова функция этого поля и как оно работает? 

3. Объясните, как работает NAT и когда он используется.


## Резюме

В этом уроке были рассмотрены основные концепции протокола IPv4, который отвечает за обеспечение связи между хостами в сети. 

Также были изучены основные операции, которые должен знать профессионал, чтобы конвертировать IP-адреса в разные форматы, а также уметь анализировать и выполнять логические конфигурации в сетях и подсетях. 

Были затронуты следующие темы: 
* Классы IP-адресов 
* Публичные и частные IP-адреса 
* Как преобразовать IP-адреса из десятичного в двоичный формат и наоборот 
* Сетевая маска (netmask) 
* Как определить сетевой и широковещательный адреса по IP и маске сети 
* Маршрут по умолчанию


## Ответы на упражнения для закрепления

**1. Используя IP-адрес `172.16.30.230` и сетевую маску `255.255.255.224`, определите:**  

| Обозначение CIDR для сетевой маски | `27`                                        |
|:-----------------------------------|:--------------------------------------------|
| Адрес сети                         | `172.16.30.224`                             |
| Широковещательный адрес            | `172.16.30.255`                             |
| Количество IP-адресов, которые можно использовать для хостов в этой подсети |`30`|

**2. Какая настройка требуется на хосте, чтобы разрешить IP-связь с хостом в другой логической сети?**  
Маршрут по умолчанию


## Ответы на упражнения для размышления

**1. Почему диапазоны IP-адресов, начинающиеся со `127`, и диапазон после `224`, не включены в классы IP-адресов A, B или C?**  
Диапазон, который начинается со `127`, зарезервирован для адресов обратной связи, используемых для тестов и внутренней связи между процессами, например, адрес `127.0.0.1`. Кроме того, адреса выше `224` также используются не в качестве адресов хоста, а для многоадресной рассылки и других целей.

**2. Одним из очень важных полей, принадлежащих IP-пакету, является TTL (*Time To Live*). Какова функция этого поля и как оно работает?**  
TTL определяет время жизни пакета. Это реализуется через счетчик, в котором начальное значение, определенное в источнике, уменьшается на каждый шлюз/маршрутизатор, через который проходит пакет, что также называется «переходом». Если этот счетчик достигает 0, пакет отбрасывается.

**3. Объясните, как работает NAT и когда он используется.**  
Функция NAT (*преобразование сетевых адресов*) позволяет хостам во внутренней сети, которая использует частные IP-адреса, иметь доступ к Интернету, как если бы они были напрямую подключены к нему, с общедоступным IP-адресом, используемым на шлюзе.
