# 103.4 Урок 1

| **Сертификат:** | LPIC-1                                    |
|:----------------|:------------------------------------------|
| **Версия:**     | 5.0                                       |
| **Тема:**       | 102 Установка Linux и управление пакетами |
| **Цель:**       | 102.1 Дизайн разметки жесткого диска      |
| **Урок:**       | 1 из 1                                    |


## Введение

Чтобы добиться успеха в этой задаче вам необходимо понимать взаимосвязь между *дисками*, *разделами*, *файловыми системами* и *томами*. 

Думайте о диске (или *запоминающем устройстве*, поскольку современные устройства вообще не содержат никаких «дисков») как о «физическом контейнере» для ваших данных. 

Прежде чем диск можно будет использовать на компьютере, его необходимо разбить на разделы. Раздел - это логическая часть физического диска, подобная логическому «забору». Разбиение - это способ «разделить» информацию, хранящуюся на диске, например, отделить данные операционной системы от данных пользователя. 

Каждому диску нужен как минимум один раздел, но при необходимости может быть несколько разделов, а информация о них хранится в таблице разделов. Эта таблица включает информацию о первом и последнем секторах раздела и его типе, а также дополнительную информацию о каждом разделе. 

Внутри каждого раздела есть файловая система. Файловая система описывает способ хранения информации на диске. Эта информация включает в себя то, как организованы каталоги, каковы отношения между ними, где находятся данные для каждого файла и т.д. 

Разделы не могут занимать несколько дисков. Но с помощью *диспетчера логических томов* (LVM) можно объединить несколько разделов, даже на разных дисках, в единый логический том. 

Логические тома абстрагируются от ограничений физических устройств и позволяют работать с «пулами» дискового пространства, которые можно объединять или распределять гораздо более гибко, чем традиционные разделы. LVM полезен в ситуациях, когда вам нужно добавить больше пространства в раздел без необходимости переноса данных на более емкое устройство. 

В этом уроке вы узнаете, как разработать схему разбиения диска для системы Linux, распределяя файловые системы и пространство подкачки для отдельных разделов или дисков, когда это необходимо. 

О том, как *создавать* и *управлять* разделами и файловыми системами, мы поговорим в других уроках. Мы бегло пробежимся по LVM в этом уроке, так как подробное объяснение выходит за рамки этой задачи.


## Точки монтирования

Прежде чем файловая система станет доступной в Linux, ее необходимо *смонтировать*. Это означает прикрепление файловой системы к определенной точке в дереве каталогов вашей системы, называемой *точкой монтирования*. 

После монтирования содержимое файловой системы будет доступно в точке монтирования. Например, представьте, что у вас есть раздел с личными данными ваших пользователей(их домашние каталоги), содержащий каталоги `/john`, `/jack` и `/carol`. При монтировании в `/home` содержимое этих каталогов будет доступно в `/home/john`, `/home/jack` и `/home/carol`. 

Точка монтирования должна существовать до монтирования файловой системы. Вы не можете смонтировать раздел в `/mnt/userdata`, если этот каталог не существует. Однако, если каталог существует и содержит файлы, эти файлы будут недоступны, пока вы не отмонтируете файловую систему. Если вы просмотрите содержимое каталога, вы увидите файлы, хранящиеся в смонтированной файловой системе, а не исходное содержимое каталога. 

Файловые системы можно смонтировать где угодно. Однако есть некоторые устоявшиеся принципы, которым следует следовать, чтобы упростить системное администрирование. 

Традиционно `/mnt` был каталогом, в котором монтируются все внешние устройства, и ряд предварительно сконфигурированных *точек привязки* для общих устройств, таких как приводы CD-ROM (`/mnt/cdrom`) и гибкие диски (`/mnt/floppy`), связаннх с ними. 

Он был заменен на `/media`, который теперь является точкой монтирования по умолчанию для любых съемных носителей (например, внешних дисков, USB-накопителей, устройств чтения карт памяти, оптических дисков и т. д.), подключенных к системе. 

В большинстве современных дистрибутивов Linux и окружений рабочего стола съемные устройства автоматически монтируются в `/media/USER/LABEL` при подключении к системе, где `USER` - это имя пользователя, а `LABEL` - это метка устройства. Например, USB-накопитель с меткой `FlashDrive`, подключенный пользователем `john`, будет смонтирован в `/media/john/FlashDrive/`. То, как это делается, зависит от среды рабочего стола. 

При этом всякий раз, когда вам нужно *вручную* смонтировать файловую систему, рекомендуется монтировать ее в `/mnt`. Конкретные команды для управления монтированием и размонтированием файловых систем в Linux будут рассмотрены в другом уроке.


## Раздельное хранение данных

В Linux есть некоторые каталоги, которые следует хранить в отдельных разделах. Для этого есть много причин: например, сохраняя файлы, связанные с загрузчиком (хранящиеся в `/boot`) на *загрузочном разделе*, вы гарантируете, что ваша система все еще сможет загружаться в случае сбоя в корневой файловой системе. 

Хранение личных каталогов пользователей (в `/home`) в отдельном разделе упрощает переустановку системы без риска случайного доступа к пользовательским данным. Хранение данных, связанных с веб-сервером или сервером базы данных (обычно в `/var`) на отдельном разделе (или даже на отдельном диске), упрощает системное администрирование, если вам потребуется добавить больше дискового пространства для таких случаев использования. 

Могут быть даже причины для повышения производительности, чтобы определенные каталоги находились в отдельных разделах. Возможно, вы захотите сохранить корневую файловую систему (`/`) на быстром SSD-накопителе, а каталоги большего размера, такие как `/home` и `/var`, на более медленных жестких дисках, которые предлагают гораздо больше места за меньшую стоимость.


### Загрузочный раздел (`/boot`)

Загрузочный раздел содержит файлы, используемые загрузчиком для загрузки операционной системы. В системах Linux загрузчиком обычно является GRUB2 или, в более старых системах, GRUB Legacy. Раздел обычно монтируется в `/boot`, а его файлы хранятся в `/boot/grub`. 

Технически загрузочный раздел не нужен, поскольку в большинстве случаев GRUB может монтировать корневой раздел (`/`) и загружать файлы из отдельного каталога `/boot`. 

Тем не менее, отдельный загрузочный раздел может быть желателен для безопасности (обеспечение загрузки системы даже в случае сбоя корневой файловой системы), или если вы хотите использовать файловую систему, которую загрузчик не может понять в корневом разделе, или если она использует неподдерживаемый метод шифрования или сжатия. 

Загрузочный раздел обычно является первым разделом на диске. Это связано с тем, что исходный BIOS IBM PC адресовал диски с использованием *цилиндров*, *головок* и *секторов* (CHS) с максимальным размером 1024 цилиндров, 256 головок и 63 секторов, что привеодит к максимальному размеру диска 528МБ (504МБ в MS-DOS). Это означает, что все, что выходит за рамки этой отметки, будет недоступно в устаревших системах, если не будет использована другая схема адресации диска (например, *логическая адресация блоков*, LBA). 

Таким образом, для максимальной совместимости загрузочный раздел обычно расположен в начале диска и заканчивается перед 1024 цилиндром(528МБ), гарантируя, что несмотря ни на что, машина всегда сможет загрузить ядро. 

Поскольку в загрузочном разделе хранятся только файлы, необходимые для загрузчика, начального RAM-диска и образов ядра, по сегодняшним меркам он может быть довольно маленьким. Хороший размер - около 300 МБ.


### Системный раздел EFI (ESP)

*Системный раздел EFI* (ESP) используется машинами на базе *Unified Extensible Firmware Interface* (UEFI) для хранения загрузчиков и образов ядра для установленных операционных систем. 

Этот раздел отформатирован в файловой системе на основе FAT. На диске, разделенном таблицей разделов GUID, он имеет глобальный уникальный идентификатор `C12A7328-F81F-11D2-BA4B-00A0C93EC93B`. Если диск был отформатирован по схеме разделения MBR, идентификатор раздела - `0xEF`. 

На машинах под управлением Microsoft Windows этот раздел обычно является первым на диске, хотя это и не требуется. ESP создается (или заполняется) операционной системой при установке, а в системе Linux монтируется в `/boot/efi`.


### Раздел `/home`

У каждого пользователя в системе есть домашний каталог для хранения личных файлов и настроек, и большинство из них находится в `/home`. Обычно домашний каталог совпадает с именем пользователя, поэтому у пользователя John будет его каталог в `/home/john`. 

Однако бывают исключения. Например, домашним каталогом для пользователя root является `/root`, и некоторые системные службы могут связывать пользователей с домашними каталогами в другом месте. 

Нет правила для определения размера раздела для каталога `/home`(домашнего раздела). Вы должны учитывать количество пользователей в системе и то, как она будет использоваться. Например, пользователю, который только просматривает веб-страницы и обрабатывает текст, потребуется меньше места, чем тому, кто работает с редактированием видео.


### Изменяемые данные (`/var`)

Этот каталог содержит «изменяемые данные» или файлы и каталоги, в которые система должна иметь возможность записи во время работы. Сюда входят системные журналы (в `/var/log`), временные файлы (`/var/tmp`) и кэшированные данные приложения (в `/var/cache`). 

`/var/www/html` также является каталогом по умолчанию для файлов данных для веб-сервера Apache, а `/var/lib/mysql` - местом по умолчанию для файлов базы данных для сервера MySQL. Однако и то, и другое можно изменить. 

Одна из веских причин для помещения `/var` в отдельный раздел - стабильность. Многие приложения и процессы записывают в `/var` и подкаталоги, например `/var/log` или `/var/tmp`. Некорректно работающий процесс может записывать данные до тех пор, пока в файловой системе не останется свободного места. 

Если `/var` находится под `/`, это может вызвать панику ядра и повреждение файловой системы, что вызовет ситуацию, из которой будет сложно выйти. Но если `/var` хранится в отдельном разделе, корневая файловая система не пострадает. 

Как и в `/home`, нет универсального правила для определения размера раздела для `/var`, так как он будет зависеть от того, как используется система. В домашней системе это может занять всего несколько гигабайт. Но на базе данных или веб-сервере может потребоваться гораздо больше места. В таких случаях может быть разумным поместить `/var` в раздел на другом диске, а не в корневом разделе, добавив дополнительный уровень защиты от сбоя физического диска.


## Swap

Раздел подкачки используется для перемещения страниц памяти из RAM на диск по мере необходимости. Этот раздел должен быть определенного типа и настроен с помощью соответствующей утилиты `mkswap`, прежде чем его можно будет использовать. 

Раздел подкачки не может быть смонтирован, как другие, а это означает, что вы не можете получить к нему доступ, как к обычному каталогу, и просмотреть его содержимое. 

В системе может быть несколько разделов подкачки (хотя это редкость), и Linux также поддерживает использование *файлов* подкачки вместо разделов, что может быть полезно для быстрого увеличения пространства подкачки, когда это необходимо. 

Размер раздела подкачки - спорный вопрос. Старое правило из первых дней Linux («вдвое больше ОЗУ») может больше не применяться в зависимости от того, как используется система и от количества установленной физической ОЗУ. 

В документации по Red Hat Enterprise Linux 7, Red Hat рекомендует следующее:

| **Количество RAM** | **Рекомендуемый размер swap** | **Рекомендуемый размер Swap с гибернацией** |
|:-------------------|:------------------------------|:--------------------------------------------|
| < 2GB RAM          | В 2 раза больше чем объем RAM | В 3 раза больше чем объем RAM               |
| 2-8GB RAM          | Равно объему RAM              | В 2 раза больше чем объем RAM               |           
| 8-64GB RAM         | Не менее 4GB                  | В 1,5 раза больше чем объем RAM             |
| > 64GB RAM         | Не менее 4GB                  | Не рекомендуется                            |

Конечно, объем подкачки может зависеть от рабочей нагрузки. Если на машине работает критически важная служба, такая как база данных, веб-сервер или сервер SAP, целесообразно проверить документацию для этих служб (или вашего поставщика программного обеспечения) для получения рекомендаций.
> Для получения дополнительной информации о создании и включении разделов подкачки и файлов подкачки см. Урок 104.1 LPIC-1.


## LVM

Мы уже обсуждали, что диски организовываются в один или несколько разделов, причем каждый раздел содержит файловую систему, которая описывает, как хранятся файлы и связанные с ними метаданные. Одним из недостатков разбиения на разделы является то, что системный администратор должен заранее решить, как будет распределяться доступное дисковое пространство на устройстве. Это может вызвать некоторые проблемы позже, если раздел требует больше места, чем планировалось изначально. Конечно, размер разделов можно изменить, но это может быть невозможно, если, например, на диске нет свободного места. 

*Управление логическими томами* (LVM) - это форма виртуализации хранилища, которая предлагает системным администраторам более гибкий подход к управлению дисковым пространством, чем традиционное разбиение на разделы. Цель LVM - облегчить управление потребностями конечных пользователей в хранении. Базовая единица - это *физический том* (PV), который представляет собой блочное устройство в вашей системе, такое как раздел диска или массив RAID. 

PV группируются в *группы томов* (VG), которые абстрагируют базовые устройства и рассматриваются как единое логическое устройство с объединенной емкостью накопителя PV компонентов. 

Каждый том в группе томов делится на части фиксированного размера, называемые *экстентами*. Экстенты на PV называются *физическими экстентами* (PE), а на логическом томе - *логическими экстентами* (LE). Как правило, каждый логический экстент сопоставляется с физическим экстентом, но это может измениться, если используются такие функции, как зеркалирование диска. 

Группы томов можно разделить на логические тома (LV), которые функционально работают аналогично разделам, но с большей гибкостью. 

Размер логического тома, указанный при его создании, фактически определяется размером физических экстентов (по умолчанию 4 МБ), умноженным на количество экстентов на томе. Отсюда легко понять, что, например, для увеличения логического тома все, что нужно сделать системному администратору, - это добавить дополнительные экстенты из пула, доступного в группе томов. Точно так же можно удалить экстенты, чтобы уменьшить LV. 

После создания логического тома он воспринимается операционной системой как обычное блочное устройство. В `/dev` будет создано устройство с именем `/dev/VGNAME/LVNAME`, где `VGNAME` - это имя группы томов, а `LVNAME` - имя логического тома. 

Эти устройства можно отформатировать в соответствии с нужной файловой системой с помощью стандартных утилит (например, `mkfs.ext4`) и смонтировать обычными методами, вручную с помощью команды `mount` или автоматически, добавив их в файл `/etc/fstab`.


## Упражнения для закрепления

1. Где хранятся файлы для загрузчика GRUB в системах Linux? 

2. Где должен заканчиваться загрузочный раздел, чтобы компьютер всегда мог загрузить ядро? 

3. Где обычно монтируется раздел EFI? 

4. При монтировании файловой системы вручную, в какой каталог она обычно монтируется?


## Упражнения на размышление

1. Какая самая маленькая единица в группе томов? 

2. Как определяется размер логического тома? 

3. Какой идентификатор системного раздела EFI на диске, отформатированном по схеме разделения MBR? 

4. Как, помимо разделов подкачки, быстро увеличить пространство подкачки в системе Linux?


## Резюме

В этом уроке вы узнали о разбиении на разделы, о том, какие каталоги обычно хранятся в отдельных разделах и почему это делается. Кроме того, мы обсудили LVM (управление логическими томами) и то, что он может предложить более гибкий способ распределения ваших данных и дискового пространства по сравнению с традиционным разбиением. 

Обсуждались следующие файлы, термины и утилиты: 
* `/`  
Корневая файловая система Linux. 
* `/var`  
Стандартное место для «изменчивых данных», данных, которые со временем могут уменьшаться и увеличиваться. 
* `/home`  
Стандартный родительский каталог для домашних каталогов обычных пользователей системы. 
* `/boot`  
Стандартное расположение файлов загрузчика, ядра Linux и начального RAM-диска. 

* Системный раздел EFI (ESP)  
Используется системами, в которых реализован UEFI, для хранения загрузочных файлов системы. 
* Swap  
Используется для выгрузки страниц памяти ядра при интенсивном использовании ОЗУ. 
* Точки монтирования  
Расположение каталога, к которому будет подключено устройство (например, жесткий диск). 
* Партиции  
Разделы на жестком диске.


## Ответы на упражнения для закрепления

**1. Где хранятся файлы для загрузчика GRUB в системах Linux?**
В `/boot/grub`.

**2. Где должен заканчиваться загрузочный раздел, чтобы компьютер всегда мог загрузить ядро?**
Перед 1024 цилиндром.

**3. Где обычно монтируется раздел EFI?**
В `/boot/efi`.

**4. При монтировании файловой системы вручную, в какой каталог она обычно монтируется?**
в `/mnt`. Однако это не обязательно. Вы можете смонтировать раздел в любом каталоге.


## Ответы на упражнения для размышления


**1. Какая самая маленькая единица в группе томов?**
Группы томов подразделяются на экстенты.

**2. Как определяется размер логического тома?**
На размер физических экстентов, умноженный на количество экстентов на томе.

**3. Какой идентификатор системного раздела EFI на диске, отформатированном по схеме разделения MBR?**
Идентификатор - 0xEF.

**4. Как, помимо разделов подкачки, быстро увеличить пространство подкачки в системе Linux?**
Можно использовать файлы подкачки.
