# 102.4 Урок 1

| **Сертификат:** | LPIC-1                                    |
|:----------------|:------------------------------------------|
| **Версия:**     | 5.0                                       |
| **Тема:**       | 102 Установка Linux и управление пакетами |
| **Цель:**       | 102.4 Использование менеджера пакетов Debian |
| **Урок:**       | 1 из 1                                    |


## Введение

Давным-давно, когда Linux был еще в зачаточном состоянии, наиболее распространенным способом распространения программного обеспечения был сжатый файл (обычно архив `.tar.gz`) с исходным кодом, который вы распаковывали и компилировали самостоятельно. 

Однако по мере роста количества и сложности программного обеспечения необходимость в способе распространения предварительно скомпилированного программного обеспечения стала очевидной. В конце концов, не у всех были ресурсы, как по времени, так и по вычислительной мощности, для компиляции больших проектов, таких как ядро Linux или X-сервер. 

Вскоре усилились попытки стандартизировать способ распространения этих программных «пакетов», и родились первые менеджеры пакетов. Эти инструменты значительно упростили установку, настройку или удаление программного обеспечения из системы. 

Одним из них был формат пакета Debian (`.deb`) и его пакетный инструмент (`dpkg`). Сегодня они широко используются не только в самом Debian, но и в его производных, таких как Ubuntu и производных от нее. 

Другой инструмент управления пакетами, популярный в системах на базе Debian, - *Advanced Package Tool* (`apt`), который может упростить многие аспекты установки, обслуживания и удаления пакетов, делая его намного проще. 

В этом уроке мы узнаем, как использовать `dpkg` и `apt` для получения, установки, настройки и удаления программного обеспечения в системе Linux на основе Debian.


## Инструмент пакетов Debian (dpkg)

Инструмент *Debian Package* (`dpkg`) - это основная утилита для установки, настройки, обслуживания и удаления пакетов программного обеспечения в системах на основе Debian. Самая базовая операция это установка `.deb` пакета, которую можно выполнить с помощью:
```console
# dkpg -i PACKAGENAME
```
Где `PACKAGENAME` - это имя `.deb` файла, который вы хотите установить. 

Обновление пакетов выполняется таким же образом. Перед установкой пакета, `dpkg` проверит, существует ли уже  в системе предыдущая версия. В этом случае пакет будет обновлен до новой версии. В противном случае будет установлена новая копия.


## Работа с зависимостями

Очень часто пакет может зависеть от наличия в системе других пакетов. Например, редактору изображений могут потребоваться библиотеки для открытия файлов JPEG, или другой служебной программе может потребоваться набор инструментов для виджетов, таких как Qt или GTK, для своего пользовательского интерфейса. 

`dpkg` проверит, установлены ли эти зависимости в вашей системе, и не сможет установить пакет, если их нет. В этом случае `dpkg` перечислит, какие пакеты отсутствуют. Однако он *не может* самостоятельно решать зависимости. Пользователь сам должен найти `.deb` пакеты с соответствующими зависимостями и установить их. 

В приведенном ниже примере пользователь пытается установить пакет видеоредактора OpenShot, но некоторые зависимости отсутствуют:
```console
# dpkg -i openshot-qt_2.4.3+dfsg1-1_all.deb
(Reading database ... 269630 files and directories currently installed.)
Preparing to unpack openshot-qt_2.4.3+dfsg1-1_all.deb ...
Unpacking openshot-qt (2.4.3+dfsg1-1) over (2.4.3+dfsg1-1) ...
dpkg: dependency problems prevent configuration of openshot-qt:
 openshot-qt depends on fonts-cantarell; however:
  Package fonts-cantarell is not installed.
 openshot-qt depends on python3-openshot; however:
  Package python3-openshot is not installed.
 openshot-qt depends on python3-pyqt5; however:
  Package python3-pyqt5 is not installed.
 openshot-qt depends on python3-pyqt5.qtsvg; however:
  Package python3-pyqt5.qtsvg is not installed.
 openshot-qt depends on python3-pyqt5.qtwebkit; however:
  Package python3-pyqt5.qtwebkit is not installed.
 openshot-qt depends on python3-zmq; however:
  Package python3-zmq is not installed.

dpkg: error processing package openshot-qt (--install):
 dependency problems - leaving unconfigured
Processing triggers for mime-support (3.60ubuntu1) ...
Processing triggers for gnome-menus (3.32.0-1ubuntu1) ...
Processing triggers for desktop-file-utils (0.23-4ubuntu1) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for man-db (2.8.5-2) ...
Errors were encountered while processing:
 openshot-qt
```
Как показано выше, OpenShot зависит от пакетов `fonts-cantarell`, `python3-openshot`, `python3-pyqt5`, `python3-pyqt5.qtsvg`, `python3-pyqt5.qtwebkit` и `python3-zmq`. Для успешной установки OpenShot необходимо сначала установить все эти пакеты. 


## Удаление пакетов

Чтобы удалить пакет, передайте `dpkg` параметр `-r`, а затем имя пакета. Например, следующая команда удалит пакет `unrar` из системы:
```console
# dpkg -r unrar
(Reading database ... 269630 files and directories currently installed.)
Removing unrar (1:5.6.6-2) ...
Processing triggers for man-db (2.8.5-2) ...
```
Операция удаления также запускает проверку зависимостей, и пакет небудет удален, пока все остальные пакеты, зависящие от него, также не будут удалены. Если вы попытаетесь это сделать, вы получите сообщение об ошибке, подобное приведенному ниже:
```console
# dpkg -r p7zip
dpkg: dependency problems prevent removal of p7zip:
 winetricks depends on p7zip; however:
  Package p7zip is to be removed.
 p7zip-full depends on p7zip (= 16.02+dfsg-6).

dpkg: error processing package p7zip (--remove):
 dependency problems - not removing
Errors were encountered while processing:
 p7zip
```
Вы можете также передать несколько имен пакетов в `dpkg -r`, что удалит все эти пакеты срасу. 

Когда пакет удаляется, соответствующие файлы конфигурации остаются в системе. Если вы хотите удалить все, что связано с пакетом, используйте параметр `-P` (очистка) вместо `-r`.

>Вы можете заставить `dpkg` установить или удалить пакет, даже если зависимости не соблюдаются, добавив параметр `--force`, как в `dpkg -i --force PACKAGENAME`. Однако это, скорее всего, приведет установленный пакет или даже вашу систему в нерабочее состояние. Не используйте `--force`, если вы не уверены в том, что делаете.


## Получение информации о пакете

Чтобы получить информацию о `.deb` пакете, такую как его версия, архитектура, разработчик, зависимости и многое другое, используйте команду `dpkg` с параметром `-I`, за которым следует указать имя файла пакета, который вы хотите проверить:
```console
# dpkg -I google-chrome-stable_current_amd64.deb
 new Debian package, version 2.0.
 size 59477810 bytes: control archive=10394 bytes.
    1222 bytes,    13 lines      control
   16906 bytes,   457 lines   *  postinst             #!/bin/sh
   12983 bytes,   344 lines   *  postrm               #!/bin/sh
    1385 bytes,    42 lines   *  prerm                #!/bin/sh
 Package: google-chrome-stable
 Version: 76.0.3809.100-1
 Architecture: amd64
 Maintainer: Chrome Linux Team <chromium-dev@chromium.org>
 Installed-Size: 205436
 Pre-Depends: dpkg (>= 1.14.0)
 Depends: ca-certificates, fonts-liberation, libappindicator3-1, libasound2 (>= 1.0.16), libatk-bridge2.0-0 (>= 2.5.3), libatk1.0-0 (>= 2.2.0), libatspi2.0-0 (>= 2.9.90), libc6 (>= 2.16), libcairo2 (>= 1.6.0), libcups2 (>= 1.4.0), libdbus-1-3 (>= 1.5.12), libexpat1 (>= 2.0.1), libgcc1 (>= 1:3.0), libgdk-pixbuf2.0-0 (>= 2.22.0), libglib2.0-0 (>= 2.31.8), libgtk-3-0 (>= 3.9.10), libnspr4 (>= 2:4.9-2~), libnss3 (>= 2:3.22), libpango-1.0-0 (>= 1.14.0), libpangocairo-1.0-0 (>= 1.14.0), libuuid1 (>= 2.16), libx11-6 (>= 2:1.4.99.1), libx11-xcb1, libxcb1 (>= 1.6), libxcomposite1 (>= 1:0.3-1), libxcursor1 (>> 1.1.2), libxdamage1 (>= 1:1.1), libxext6, libxfixes3, libxi6 (>= 2:1.2.99.4), libxrandr2 (>= 2:1.2.99.3), libxrender1, libxss1, libxtst6, lsb-release, wget, xdg-utils (>= 1.0.2)
 Recommends: libu2f-udev
 Provides: www-browser
 Section: web
 Priority: optional
 Description: The web browser from Google
  Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.
```


## Список установленных пакетов и их содержимого

Чтобы получить список всех пакетов, установленных в вашей системе, используйте параметр `--get-selections`, как в `dpkg --get-selections`. Вы также можете получить список всех файлов, установленных конкретным пакетом, передав параметр `-L PACKAGENAME` в `dpkg`, как показано ниже:
```console
# dpkg -L unrar
/.
/usr
/usr/bin
/usr/bin/unrar-nonfree
/usr/share
/usr/share/doc
/usr/share/doc/unrar
/usr/share/doc/unrar/changelog.Debian.gz
/usr/share/doc/unrar/copyright
/usr/share/man
/usr/share/man/man1
/usr/share/man/man1/unrar-nonfree.1.gz
```


## Определение того, какой пакет яляется владельцем конкретного файла

Иногда вам может потребоваться выяснить, какой пакет владеет конкретным файлом в вашей системе. Вы можете сделать это с помощью утилиты `dpkg-query`, за которой следует параметр `-S` и путь к рассматриваемому файлу:
``` console
# dpkg-query -S /usr/bin/unrar-nonfree
unrar: /usr/bin/unrar-nonfree
```


## Перенастройка установленных пакетов

Когда пакет установлен, существует этап настройки, называемый *пост-установкой*, на котором запускается скрипт  настройки всего необходимого для запуска программного обеспечения, такого как права доступа, размещение файлов конфигурации и т. д. Он также может задать пользователю некоторые вопросы насчет установки предпочтений относительно того, как будет работать программное обеспечение. 

Иногда из-за поврежденного или некорректного файла конфигурации вам может потребоваться восстановить настройки пакета по умолчанию. Или вы можете изменить ответы на вопросы, которые вы дали в момент начальной конфигурации. Для этого запустите утилиту `dpkg-reconfigure`, после которой укажите имя пакета. 

Эта программа создаст резервную копию старых файлов конфигурации, распакует новые в правильные каталоги и запустит скрипт *пост-установки*, предоставленный пакетом, как если бы пакет был установлен впервые. Попробуйте перенастроить пакет `tzdata` с помощью следующего примера:
```console
# dpkg-reconfigure tzdata
```


## Расширенный пакетный инструмент (APT)

*Advanced Package Tool* (APT) - это система управления пакетами, включающая набор инструментов, которая значительно упрощает установку, обновление, удаление пакетов и управление ими. APT предоставляет такие функции, как расширенные возможности поиска и автоматическое разрешение зависимостей. 

APT не заменяет `dpkg`. Вы можете представить его как о «внешний интерфейс», оптимизирующий операции и заполняющий пробелы в функциональности `dpkg`, например в разрешении зависимостей. 

APT работает совместно с репозиториями программного обеспечения, которые содержат пакеты, доступные для установки. Такие репозитории могут быть расположены локально или на удаленном сервере или даже на диске CD-ROM. 

Дистрибутивы Linux, такие как Debian и Ubuntu, поддерживают свои собственные репозитории, а другие репозитории могут поддерживаться разработчиками или группами пользователей для предоставления программного обеспечения, недоступного в основных репозиториях дистрибутива. 

Есть много утилит, которые взаимодействуют с APT, основными из которых являются: 

`apt-get`  
используется для загрузки, установки, обновления или удаления пакетов из системы. 

`apt-cache`  
используется для выполнения операций, таких как поиск, в индексе пакета. 

`apt-file`  
используется для поиска файлов внутри пакетов. 

Существует также более «дружелюбная» утилита, названная просто `apt`, объединяющая в одной утилите наиболее часто используемые опции `apt-get` и `apt-cache`. Многие команды для `apt` такие же, как и для `apt-get`, поэтому во многих случаях они взаимозаменяемы. Однако, поскольку `apt` может быть не установлен в системе, рекомендуется научиться использовать `apt-get` и `apt-cache`.

>Для `apt` и `apt-get` могут требовать сетевое соединение, поскольку пакеты и индексы пакетов могут нуждаться в загрузке их с удаленного сервера.


## Обновление индекса пакета

Перед установкой или обновлением программного обеспечения с помощью APT рекомендуется сначала обновить индекс пакетов, чтобы получить информацию о новых и обновленных пакетах. Это делается с помощью команды `apt-get`, за которой следует параметр `update`:
```console
# apt-get update
Ign:1 http://dl.google.com/linux/chrome/deb stable InRelease
Hit:2 https://repo.skype.com/deb stable InRelease
Hit:3 http://us.archive.ubuntu.com/ubuntu disco InRelease
Hit:4 http://repository.spotify.com stable InRelease
Hit:5 http://dl.google.com/linux/chrome/deb stable Release
Hit:6 http://apt.pop-os.org/proprietary disco InRelease
Hit:7 http://ppa.launchpad.net/system76/pop/ubuntu disco InRelease
Hit:8 http://us.archive.ubuntu.com/ubuntu disco-security InRelease
Hit:9 http://us.archive.ubuntu.com/ubuntu disco-updates InRelease
Hit:10 http://us.archive.ubuntu.com/ubuntu disco-backports InRelease
Reading package lists... Done
```
>Вместо `apt-get update` вы также можете использовать `apt update`.


## Установка и удаление пакетов

После обновления индекса пакета вы можете теперь установить пакет. Это делается с помощью `apt-get install`, за которым следует имя пакета, который вы хотите установить:
```console
# apt-get install xournal
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  xournal
0 upgraded, 1 newly installed, 0 to remove and 75 not upgraded.
Need to get 285 kB of archives.
After this operation, 1041 kB of additional disk space will be used.
```
Точно так же, чтобы удалить пакет, используйте команду `apt-get remove`, за которой следует имя пакета:
```console
# apt-get remove xournal
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be REMOVED:
  xournal
0 upgraded, 0 newly installed, 1 to remove and 75 not upgraded.
After this operation, 1041 kB disk space will be freed.
Do you want to continue? [Y/n]
```
Имейте в виду, что при установке или удалении пакетов APT выполнит автоматическое разрешение зависимостей. Это означает, что любые дополнительные пакеты, необходимые для устанавливаемого пакета, также будут установлены, и что пакеты, которые зависят от пакета, который вы удаляете, также будут удалены. APT всегда будет показывать, что будет установлено или удалено, прежде чем спросить, хотите ли вы продолжить:
```console
# apt-get remove p7zip
Reading package lists... Done
Building dependency tree
The following packages will be REMOVED:
  android-libbacktrace android-libunwind android-libutils
  android-libziparchive android-sdk-platform-tools fastboot p7zip p7zip-full
0 upgraded, 0 newly installed, 8 to remove and 75 not upgraded.
After this operation, 6545 kB disk space will be freed.
Do you want to continue? [Y/n]
```
Обратите внимание, что при удалении пакета соответствующие файлы конфигурации остаются в системе. Чтобы удалить пакет и любые файлы конфигурации, используйте параметр `purge` вместо `remove` или параметр `remove` с параметром `--purge`:
```console
# apt-get purge p7zip
```
или
```console
# apt-get remove --purge p7zip
```
>Вы также можете использовать `apt install` и `apt remove`.


## Исправление нарушеных зависимостей

В системе могут быть «нарушенные зависимости». Это означает, что один или несколько установленных пакетов зависят от других пакетов, которые не были установлены или больше не присутствуют. Это может произойти из-за ошибки APT или из-за пакета, установленного вручную. 

Чтобы решить эту проблему, используйте команду `apt-get install -f`. Она попытается «исправить» сломанные пакеты, установив недостающие зависимости, гарантируя, что все пакеты снова будут согласованы.

>Вы также можете использовать `apt install -f`.


## Обновление пакетов

APT можно использовать для автоматического обновления любых установленных пакетов до последних версий, доступных в репозиториях. Это делается с помощью команды `apt-get upgrade`. Перед его запуском сначала обновите индекс пакета с помощью `apt-get update`:
```console
# apt-get update
Hit:1 http://us.archive.ubuntu.com/ubuntu disco InRelease
Hit:2 http://us.archive.ubuntu.com/ubuntu disco-security InRelease
Hit:3 http://us.archive.ubuntu.com/ubuntu disco-updates InRelease
Hit:4 http://us.archive.ubuntu.com/ubuntu disco-backports InRelease
Reading package lists... Done

# apt-get upgrade
Reading package lists... Done
Building dependency tree
Reading state information... Done
Calculating upgrade... Done
The following packages have been kept back:
  gnome-control-center
The following packages will be upgraded:
  cups cups-bsd cups-client cups-common cups-core-drivers cups-daemon
  cups-ipp-utils cups-ppdc cups-server-common firefox-locale-ar (...)

74 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 243 MB of archives.
After this operation, 30.7 kB of additional disk space will be used.
Do you want to continue? [Y/n]
```
Сводка в нижней части выходных данных показывает, сколько пакетов будет обновлено, сколько будет установлено, удалено или сохранено, общий размер загрузки и сколько дополнительного дискового пространства потребуется для завершения операции. Чтобы завершить обновление, просто ответьте `Y` и подождите, пока `apt-get` завершит задачу. 

Чтобы обновить один пакет, просто запустите `apt-get upgrade`, а затем укажите имя пакета. Как и в случае с `dpkg`, `apt-get` сначала проверяет, установлена ли предыдущая версия пакета. В этом случае пакет будет обновлен до последней версии, доступной в репозитории. В противном случае будет установлена новая копия.

>Вы также можете использовать apt upgrade и apt update.


## Локальный кеш

Когда вы устанавливаете или обновляете пакет, соответствующий `.deb` файл загружается в каталог локального кэша перед установкой пакета. По умолчанию это каталог `/var/cache/apt/archives`. Частично загруженные файлы копируются в `/var/cache/apt/archives/partial/`. 

По мере установки и обновления пакетов каталог кеша может стать довольно большим. Чтобы освободить место, вы можете очистить кеш с помощью команды `apt-get clean`. Это удалит содержимое каталогов `/var/cache/apt/archives` и `/var/cache/apt/archives/partial/`.

```console
You can also use apt clean.
```


## Поиск пакетов

Утилиту `apt-cache` можно использовать для выполнения операций с индексом пакета, таких как поиск определенного пакета или перечисление пакетов, содержащих конкретный файл. 

Чтобы выполнить поиск, используйте поиск `apt-cache` с последующим шаблоном поиска. Результатом будет список всех пакетов, содержащих шаблон, либо в имени пакета, либо в описании, либо в предоставленных файлах.

```console
# apt-cache search p7zip
liblzma-dev - XZ-format compression library - development files
liblzma5 - XZ-format compression library
forensics-extra - Forensics Environment - extra console components (metapackage)
p7zip - 7zr file archiver with high compression ratio
p7zip-full - 7z and 7za file archivers with high compression ratio
p7zip-rar - non-free rar module for p7zip
```

В приведенном выше примере запись `liblzma5 - XZ-format compression library` не соответствует шаблону. Однако, если мы покажем полную информацию, включая описание, для пакета с помощью параметра `show`, мы найдем там шаблон:
```console
# apt-cache show liblzma5
Package: liblzma5
Architecture: amd64
Version: 5.2.4-1
Multi-Arch: same
Priority: required
Section: libs
Source: xz-utils
Origin: Ubuntu
Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Original-Maintainer: Jonathan Nieder <jrnieder@gmail.com>
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 259
Depends: libc6 (>= 2.17)
Breaks: liblzma2 (<< 5.1.1alpha+20110809-3~)
Filename: pool/main/x/xz-utils/liblzma5_5.2.4-1_amd64.deb
Size: 92352
MD5sum: 223533a347dc76a8cc9445cfc6146ec3
SHA1: 8ed14092fb1caecfebc556fda0745e1e74ba5a67
SHA256: 01020b5a0515dbc9a7c00b464a65450f788b0258c3fbb733ecad0438f5124800
Homepage: https://tukaani.org/xz/
Description-en: XZ-format compression library
 XZ is the successor to the Lempel-Ziv/Markov-chain Algorithm
 compression format, which provides memory-hungry but powerful
 compression (often better than bzip2) and fast, easy decompression.
 .
 The native format of liblzma is XZ; it also supports raw (headerless)
 streams and the older LZMA format used by lzma. (For 7-Zip's related
 format, use the p7zip package instead.)
 ```
Вы можете использовать *регулярные выражения* с шаблоном поиска, что позволяет выполнять очень сложный (и точный) поиск. Однако эта тема выходит за рамки данного урока.

>Вы также можете использовать `apt search` вместо поиска `apt-cache` и `apt show` вместо `apt-cache show`.


## Список источников

APT использует список источников, чтобы узнать, откуда брать пакеты. Этот список хранится в файле `sources.list`, расположенном в каталоге `/etc/apt`. Этот файл можно редактировать непосредственно с помощью текстового редактора, такого как `vi`, `pico` или `nano`, или с помощью графических утилит, таких как `aptitude` или `synaptic`. Типичная строка внутри `sources.list` выглядит так:

```console
deb http://us.archive.ubuntu.com/ubuntu/ disco main restricted universe
multiverse
```

Его синтакс - тип архива, URL, распространение и один или несколько компонентов, где: 

**Archive type**  
Репозиторий может содержать пакеты с готовым к запуску программным обеспечением (двоичные пакеты, тип `deb`) или с исходным кодом этого программного обеспечения (исходные пакеты, тип `deb-src`). В приведенном выше примере представлены бинарные пакеты. 

**URL**  
URL-адрес репозитория. 

**Распространение**  
Имя (или кодовое имя) дистрибутива, для которого предоставляются пакеты. В одном репозитории могут размещаться пакеты для нескольких дистрибутивов. В приведенном выше примере `disco` - это кодовое имя для Ubuntu 19.04 *Disco Dingo*. 

**Компоненты**  
Каждый компонент представляет собой набор пакетов. Эти компоненты могут отличаться в разных дистрибутивах Linux. 

Например, в Ubuntu и производных версиях это: 

`main`  
содержит официально поддерживаемые пакеты с открытым исходным кодом. 

`restricted`  
содержит официально поддерживаемое программное обеспечение с закрытым исходным кодом, например драйверы устройств для графических карт. 

`universe`  
содержит программное обеспечение с открытым исходным кодом, поддерживаемое сообществом. 

`multiverse`  
содержит неподдерживаемое программное обеспечение, программное обеспечение с закрытым исходным кодом или обремененное патентами. 

В Debian основными компонентами являются: 

`main`  
состоит из пакетов, совместимых с Руководством по свободному программному обеспечению Debian (DFSG), работа которых не зависит от программного обеспечения за пределами этой области. Включенные здесь пакеты считаются частью дистрибутива Debian. 

`contrib`  
содержит пакеты, совместимые с DFSG, но которые зависят от других пакетов, которых нет в `main`. 

`non-free`  
содержит пакеты, несовместимые с DFSG. 

`security`  
содержит обновления безопасности. 

`backports`  
содержит более свежие версии пакетов, которые находятся в файле `main`. Цикл разработки стабильных версий Debian довольно длинный (около двух лет), и это гарантирует, что пользователи могут получить самые свежие пакеты без необходимости изменять основной репозиторий ядра.

>Вы можете узнать больше о *Руководстве по свободному программному обеспечению Debian* по адресу: https://www.debian.org/social_contract#guidelines

Чтобы добавить новый репозиторий для получения пакетов, вы можете просто добавить соответствующую строку (обычно предоставляемую разработчиком репозитория) в конец `sources.list`, сохранить файл и перезагрузить индекс пакета с помощью `apt-get update`. После этого пакеты в новом репозитории будут доступны для установки с помощью `apt-get install`. 

Имейте в виду, что строки, начинающиеся с символа `#`, считаются комментариями и игнорируются.


### Каталог `/etc/apt/sources.list.d`

Внутри каталога `/etc/apt/sources.list.d` вы можете добавлять файлы с дополнительными репозиториями, которые будут использоваться APT, без необходимости изменять основной файл `/etc/apt/sources.list`. Это простые текстовые файлы с таким же синтаксисом, как описано выше, и с расширением файла `.list`. 

Ниже вы видите содержимое файла с именем `/etc/apt/sources.list.d/buster-backports.list`:
```console
deb http://deb.debian.org/debian buster-backports main contrib non-free
deb-src http://deb.debian.org/debian buster-backports main contrib non-free
```

### Список содержимого пакета и поиск файлов

Утилиту под названием `apt-file` можно использовать для выполнения дополнительных операций с индексом пакета, таких как перечисление содержимого пакета или поиск пакета, содержащего определенный файл. Эта утилита может не быть установлена в вашей системе по умолчанию. В этом случае вы обычно можете установить его с помощью `apt-get`:
```console
# apt-get install apt-file
```
После установки вам нужно будет обновить кеш пакетов, используемый для `apt-file`:
```console
# apt-file update
```
Обычно это занимает всего несколько секунд. После этого вы готовы к использованию `apt-file`. 

Чтобы вывести список содержимого пакета, используйте параметр `list`, за которым следует имя пакета:
```console
# apt-file list unrar
unrar: /usr/bin/unrar-nonfree
unrar: /usr/share/doc/unrar/changelog.Debian.gz
unrar: /usr/share/doc/unrar/copyright
unrar: /usr/share/man/man1/unrar-nonfree.1.gz
```
>Вы также можете использовать `apt list` вместо списка `apt-file`.

Вы можете искать файл во всех пакетах, используя параметр поиска, за которым следует имя файла. Например, если вы хотите узнать, какой пакет предоставляет файл с именем `libSDL2.so`, вы можете использовать:
```console
# apt-file search libSDL2.so
libsdl2-dev: /usr/lib/x86_64-linux-gnu/libSDL2.so
```
Ответ - пакет `libsdl2-dev`, который предоставляет файл `/usr/lib/x86_64-linux-gnu/libSDL2.so`. 

Разница между поиском `apt-file` и `dpkg-query` заключается в том, что поиск `apt-file` также будет искать неустановленные пакеты, в то время как `dpkg-query` может отображать только файлы, принадлежащие установленному пакету.


## Упражнения для закрепления

1. Какая команда используется для установки пакета с именем `package.deb` с помощью `dpkg`? 

2. Используя `dpkg-query`, найдите, какой пакет содержит файл с именем `7zr.1.gz`. 

3. Можете ли вы удалить пакет под названием `unzip` из системы с помощью `dpkg -r unzip`, если от него зависит пакет `file-roller`? Если нет, как правильно это сделать? 

4. Как с помощью `apt-file` узнать, какой пакет содержит файл `unrar`? 

5. Какая команда показывает информацию о пакете `gimp` при использовании `apt-cache`?


## Упражнения на размышление

1. Рассмотрите репозиторий с исходными пакетами Debian для дистрибутива `xenial`, размещенный по адресу `http://us.archive.ubuntu.com/ubuntu/`, и с пакетами для компонента `universe`. Какую строку нужно добавить в `/etc/apt/sources.list`? 
2. При компиляции программы вы сталкиваетесь с сообщением об ошибке с жалобой на то, что файл заголовка `zzip-io.h` отсутствует в вашей системе. Как вы можете узнать, что пакет предоставляет этот файл? 
3. Как можно игнорировать предупреждение о зависимости и удалить пакет с помощью `dpkg`, даже если в системе есть зависящие от него пакеты? 
4. Как получить дополнительную информацию о пакете `midori` с помощью `apt`? Какую команду следует использовать перед установкой или обновлением пакетов с помощью `apt`, чтобы обеспечить актуальность индекса пакета?


## Резюме

На этом уроке вы узнали: 
* Как использовать `dpkg` для установки и удаления пакетов. 
* Как вывести список установленных пакетов и их содержимого. 
* Как перенастроить установленный пакет. 
* Что такое `apt` и как с его помощью устанавливать, обновлять и удалять пакеты. 
* Как использовать `apt-cache` для поиска пакетов. 
* Как работает файл `/etc/apt/sources.list`. 
* Как использовать `apt-file` для отображения содержимого пакета или как найти, какой пакет содержит конкретный файл. 

Обсуждались следующие команды: 

`dpkg -i`  
Устанавливает один пакет или список пакетов, разделенных пробелами. 

`dpkg -r`  
Удаляет пакет или список пакетов, разделенных пробелами. 

`dpkg -I`  
Проверяет пакет, предоставляя подробную информацию об устанавливаемом им программном обеспечении и любых необходимых зависимостях. 

`dpkg --get-selections`  
Список всех пакетов, установленных `dpkg` в системе. 

`dpkg -L`  
Выводит список всех файлов, устанавливаемых конкретным пакетом. 

`dpkg-query`  
С указанным именем файла эта команда выводит пакет, который установил файл. 

`dpkg-reconfigure`  
Эта команда повторно запустит сценарий после установки пакета, чтобы администратор мог внести изменения в конфигурацию установки пакета. 

`apt-get update`  
Эта команда обновит локальный индекс пакета, чтобы он соответствовал тому, что доступно в настроенных репозиториях в каталоге `/etc/apt/`. 

`apt-get install`  
Эта команда загрузит пакет из удаленного репозитория и установит его вместе с зависимостями, также может использоваться для установки пакета Debian, который уже был загружен. 

`apt-get remove`  
Эта команда удалит указанные пакеты из системы. 

`apt-cache show`  
Как и команду `dpkg -I`, эту команду можно использовать для отображения сведений о конкретном пакете. 

`apt-cache search`  
Эта команда будет искать конкретный пакет в вашей локальной кэшированной базе данных APT. 

`apt-file update`  
Эта команда обновит кеш пакета, чтобы команда `apt-file` могла запрашивать его содержимое. 

`apt-file search`  
Эта команда будет искать, в какой пакет включен файл. Возвращается список всех пакетов, содержащих шаблон. 

`apt-file list`  
Эта команда используется для вывода списка содержимого пакета, как и команда `dpkg -L`.


## Ответы на упражнения для закрепления

**1. Какая команда используется для установки пакета с именем `package.deb` с помощью `dpkg`?**
Передайте параметр `-i в dpkg`:
```console
# dpkg -i package.deb
```

**2. Используя `dpkg-query`, найдите, какой пакет содержит файл с именем `7zr.1.gz`.**
Добавьте параметр `-S` в `dpkg-query`:
```console
# dpkg-query -S 7zr.1.gz
```

**3. Можете ли вы удалить пакет под названием `unzip` из системы с помощью `dpkg -r unzip`, если от него зависит пакет `file-roller`? Если нет, как правильно это сделать?**
Нет. `dpkg` не разрешит зависимости и не позволит вам удалить пакет, если от него зависит другой установленный пакет. В этом примере вы можете сначала удалить `file-roller` (при условии, что от него ничего не зависит), а затем удалить `unzip` или удалить оба файла одновременно с помощью:
```console
# dpkg -r unzip file-roller
```

**4. Как с помощью `apt-file` узнать, какой пакет содержит файл `unrar`?**
Используйте параметр `search`, за которым следует путь (или имя файла):
```console
# apt-file search /usr/bin/unrar
```

**5. Какая команда показывает информацию о пакете `gimp` при использовании `apt-cache`?**
Используйте параметр `show`, за которым следует имя пакета:
```console
# apt-cache show gimp
```


## Ответы на упражнения для размышления

**1. Рассмотрите репозиторий с исходными пакетами Debian для дистрибутива `xenial`, размещенный по адресу `http://us.archive.ubuntu.com/ubuntu/`, и с пакетами для компонента `universe`. Какую строку нужно добавить в `/etc/apt/sources.list`?**
Пакеты с исходным кодом относятся к типу `deb-src`, поэтому строка должна быть такой:
```console
deb-src http://us.archive.ubuntu.com/ubuntu/ xenial universe
```
Эту строку также можно добавить в файл `.list` в `/etc/apt/sources.list.d/`. Название зависит от вас, но оно должно быть описательным, например `xenial_sources.list`.

**2. При компиляции программы вы сталкиваетесь с сообщением об ошибке с жалобой на то, что файл заголовка `zzip-io.h` отсутствует в вашей системе. Как вы можете узнать, что пакет предоставляет этот файл?**
Используйте `apt-file search`, чтобы найти, какой пакет содержит файл, отсутствующий в системе:
```console
# apt-file search zzip-io.h
```

**3. Как можно игнорировать предупреждение о зависимости и удалить пакет с помощью `dpkg`, даже если в системе есть зависящие от него пакеты?**
Можно использовать параметр `--force`, но этого никогда не следует делать, если вы точно не знаете, что делаете, поскольку существует большой риск того, что ваша система останется в несогласованном или «сломанном» состоянии.

**4. Как получить дополнительную информацию о пакете `midori` с помощью `apt`? Какую команду следует использовать перед установкой или обновлением пакетов с помощью `apt`, чтобы обеспечить актуальность индекса пакета?**
Следует использовать `apt-get update`. Это загрузит последние индексы пакетов из репозиториев, описанных в файле `/etc/apt/sources.list` или в каталоге `/etc/apt/sources.list.d/`.
