# 103.8 Урок 1

| **Сертификат:** | LPIC-1                                      |
|:----------------|:--------------------------------------------|
| **Версия:**     | 5.0                                         |
| **Тема:**       | 103 GNU и Unix комманды                     |                           
| **Цель:**       | 103.8 Базовое редактирование файлов         |
| **Урок:**       | 1 из 1                                      |


## Введение

В большинстве дистрибутивов Linux `vi` - аббревиатура от «visual» - предустановлен и является стандартным редактором в среде оболочки. Vi - это интерактивный текстовый редактор, он показывает содержимое файла на экране по мере его редактирования. Таким образом, он позволяет пользователю перемещаться и вносить изменения в любом месте документа. Однако, в отличие от визуальных редакторов с графического рабочего стола, редактор `vi` представляет собой приложение оболочки с сочетаниями клавиш для каждой задачи редактирования. 

Альтернатива `vi`, называемая `vim` (vi *усовершенствованный*), иногда используется как современная замена `vi`. Среди других улучшений `vim` предлагает поддержку подсветки синтаксиса, многоуровневой отмены/повтора и редактирования нескольких документов. Хотя `vim` более изобретателен, он полностью обратно совместим с `vi`, что делает их неразличимыми для большинства задач. 

Стандартный способ запустить `vi` - указать путь к файлу в качестве параметра. Чтобы перейти непосредственно к определенной строке, ее номер должен быть обозначен знаком плюса, как в `vi +9 /etc/fstab`, чтобы открыть `/etc/fstab` и поместить курсор в 9-ю строку. Без числа знак плюса сам по себе помещает курсор в последнюю строку. 

Интерфейс `vi` очень прост: все пространство, доступное в окне терминала, занято для представления пользователю файла, обычно сообщаемого как аргумент команды. Единственные визуальные подсказки - это нижний колонтитул, показывающий текущее положение курсора, и тильда `~`, указывающая, где заканчивается файл. Для `vi` существуют разные режимы выполнения, в которых поведение программы меняется. Наиболее распространены: *режим вставки* и *нормальный режим*.


## Режим вставки

Режим вставки прост: текст появляется на экране, когда он набирается на клавиатуре. Это тот тип взаимодействия, который большинство пользователей ожидают от текстового редактора, но это не то, как `vi` сначала представляет документ. Чтобы войти в режим вставки, пользователь должен выполнить команду вставки в обычном режиме. Клавиша <kbd>Esc</kbd> завершает режим вставки и возвращает в нормальный режим, режим `vi` по умолчанию.

>Если вам интересно узнать больше о других режимах выполнения, откройте `vi` и введите:
>```console
>:help vim-modes-intro
>```


## Нормальный режим

По умолчанию `vi` запускается в обычном режиме, также известном как командный режим. В этом режиме клавиши клавиатуры связаны с командами для задач навигации и обработки текста. Большинство команд в этом режиме - уникальные ключи. Некоторые клавиши и их функции в обычном режиме: 

`0`, `$`  
Перейти в начало и конец строки. 

`1G`, `G`  
Перейти в начало и конец документа. 

`(`,`)`  
Перейти к началу и концу предложения. 

`{`,`}`  
Перейти в начало и конец абзаца. 

`w`, `W`  
Перейти на слово и перейти на слово, включая знаки препинания. 

`h`, `j`, `k`, `l`  
Влево, вниз, вверх, вправо. 

`e` или `E`  
Перейти в конец текущего слова. 

`/`, `?`  
Искать вперед и назад. 

`i`, `I`  
Войти в режим вставки перед текущей позицией курсора и в начале текущей строки. 

`a`, `A`  
Войти в режим вставки после текущей позиции курсора и в конце текущей строки. 

`o`, `O`  
Добавить новую строку и войти в режим вставки в следующей или предыдущей строке. 

`s`, `S`  
Стереть символ под курсором или всю строку и войдите в режим вставки. 

`c`  
Изменить символ (символы) под курсором. 

`р`  
Заменить символ под курсором. 

`x`  
Удалить выбранные символы или символ под курсором. 

`v`, `V`  
Начать выделение с текущего символа или всей строки. 

`y`, `yy`  
Скопировать (выдернуть) символ (символы) или всю строку. 

`p`, `P`  
Вставить скопированный контент после или до текущей позиции. 

`u`  
Отменить последнее действие. 

`Ctrl-R`  
Повторить последнее действие. 

`ZZ`  
Закрыть и сохранить. 

`ZQ`  
Закрыть и не сохранять. 

Если перед ней стоит число, команда будет выполняться одинаковое количество раз. Например, нажмите `3yy`, чтобы скопировать текущую строку плюс две следующие, нажмите `d5w`, чтобы удалить текущее слово и следующие `4` слова, и так далее. 

Большинство задач редактирования представляют собой комбинации нескольких команд. Например, последовательность клавиш `vey` используется для копирования выделения, начиная с текущей позиции, до конца текущего слова. Повторение команд также можно использовать в комбинациях, поэтому `v3ey` будет копировать выделение, начиная с текущей позиции, до конца третьего слова оттуда. 

`vi` может организовывать скопированный текст в регистры, что позволяет одновременно сохранять различное содержимое. Регистр задается символом, которому предшествует `"` и после создания он сохраняется до конца текущего сеанса. Последовательность клавиш `"` создает регистр, содержащий текущий выбор, который будет доступен через клавишу `l`. Затем в регистр `l` можно вставить `"lp`. 

Существует также способ установить пользовательские метки в произвольных местах текста, что упрощает быстрое переключение между ними. Метки создаются нажатием клавиши `m`, а затем клавиши для адресации текущей позиции. После этого курсор вернется в отмеченное положение при нажатии `'`, а затем выбранной клавиши. 

Любая последовательность клавиш может быть записана как макрос для будущего выполнения. Например, можно записать макрос, чтобы заключить выбранный текст в двойные кавычки. Сначала выбирается строка текста и нажимается клавиша `q`, а затем клавиша регистра, с которой ассоциируется макрос, например `d`. Строка записи `@d` появится в строке нижнего колонтитула, указывая на то, что запись включена. Предполагается, что какой-то текст уже выделен, поэтому первая команда - это `x`, чтобы удалить (и автоматически скопировать) выделенный текст. Клавиша `i` нажимается, чтобы вставить две двойные кавычки в текущую позицию, затем <kbd>Esc</kbd> возвращается в нормальный режим. Последняя команда - `P` для повторной вставки удаленного выделения непосредственно перед последней двойной кавычкой. Повторное нажатие `q` завершит запись. Теперь макрос, состоящий из последовательности клавиш `x`, `i`, `""`, <kbd>Esc</kbd> и `P`, будет выполняться каждый раз при нажатии клавиш `@d` в нормальном режиме, где `d` - регистровый ключ, связанный с макросом. 

Однако макрос будет доступен только во время текущего сеанса. Чтобы макросы были постоянными, их нужно сохранить в файле конфигурации. Поскольку большинство современных дистрибутивов используют `vim` в качестве редактора, совместимого с `vi`, файл конфигурации пользователя - `~/.vimrc`. Внутри `~/.vimrc` строка `let @d = 'xi""P'` установит регистр `d` в последовательность клавиш внутри одинарных кавычек. Тот же регистр, который ранее был назначен макросу, можно использовать для вставки его последовательности клавиш.


## Команды двоеточия

Обычный режим также поддерживает другой набор команд `vi`: *команды двоеточия*. Команды с двоеточием, как следует из названия, выполняются после нажатия клавиши двоеточия <kbd>:</kbd> в обычном режиме. Команды с двоеточием позволяют пользователю выполнять поиск, сохранять, выходить, запускать команды оболочки, изменять настройки `vi` и т. д. Чтобы вернуться в нормальный режим, необходимо выполнить команду `:visual` или нажать клавишу Enter без какой-либо команды. Здесь указаны некоторые из наиболее распространенных команд с двоеточием (начальная буква не является частью команды):

`:s/REGEX/TEXT/g`  
Заменяет все вхождения регулярного выражения `REGEX` на `TEXT` в текущей строке. Он принимает тот же синтаксис команды `sed`, включая адреса. 

`:!`  
Выполните следующую команду оболочки. 

`:quit` или `:q`  
Выйти из программы. 

`:quit!` или `:q!`  
Выйти из программы без сохранения. 

`:wq`  
Сохранить и выйти. 

`:exit` или `:x` или `:e`  
Сохраните и выйдите, если необходимо. 

`:visual`  
Вернитесь в режим навигации. 

Стандартная программа `vi` может выполнять большинство задач редактирования текста, но любой другой неграфический редактор может использоваться для редактирования текстовых файлов в среде оболочки.

>У начинающих пользователей могут возникнуть трудности с одновременным запоминанием командных клавиш `vi`. В дистрибутивах, использующих `vim`, также есть команда `vimtutor`, которая использует сам `vim` для открытия пошагового руководства по основным действиям. Файл представляет собой редактируемую копию, которую можно использовать для отработки команд и постепенного привыкания к ним.


## Альтернативные редакторы

Пользователи, незнакомые с `vi`, могут столкнуться с трудностями при адаптации к нему, поскольку его работа не интуитивно понятна. Более простой альтернативой является GNU `nano`, небольшой текстовый редактор, который предлагает все основные функции редактирования текста, такие как отмена/повтор, раскраска синтаксиса, интерактивный поиск и замена, автоматический отступ, номера строк, завершение слов, блокировка файлов, файлы резервных копий и т. д. поддержка интернационализации. В отличие от `vi`, все нажатия клавиш просто вставляются в редактируемый документ. Команды в `nano` вводятся с помощью клавиши <kbd>Ctrl</kbd> или клавиши Meta (в зависимости от системы, Meta - это <kbd>Alt</kbd> или <kbd>⌘</kbd>). 

`Ctrl-6` или `Meta-A`  
Начать новый выбор. Также можно создать выделение, нажав Shift и перемещая курсор. 

`Мета-6`  
Скопируйте текущий выбор. 

`Ctrl-K`  
Вырезать текущий выбор. 

`Ctrl-U`  
Вставьте скопированный контент. 

`Meta-U`  
Отменить. 

`Meta-E`  
Повторить. 

`Ctrl-\`  
Заменить текст в выделении. 

`Ctrl-T`  
Начните сеанс проверки орфографии для документа или текущего выделения. 

Emacs - еще один очень популярный текстовый редактор для среды оболочки. В то время как текст вставляется простым вводом, как в `nano`, навигация по документу осуществляется с помощью клавиатурных команд, как в `vi`. Emacs включает в себя множество функций, которые делают его больше, чем просто текстовый редактор. Это также IDE (*интегрированная среда разработки*), способная компилировать, запускать и тестировать программы. Emacs может быть настроен как клиент электронной почты, новостей или RSS, что делает его подлинным пакетом программ для повышения производительности. 

Сама оболочка будет запускать текстовый редактор по умолчанию, обычно `vi`, каждый раз, когда это необходимо. Это имеет место, например, когда `crontab -e` выполняется для редактирования *cronjobs*. Bash использует переменные сеанса `VISUAL` или `EDITOR`, чтобы найти текстовый редактор по умолчанию для среды оболочки. Например, команда export `EDITOR=nano` определяет `nano` как текстовый редактор по умолчанию в текущем сеансе оболочки. Чтобы сделать это изменение постоянным во всех сеансах, команда должна быть включена в `~/.bash_profile`.


# Упражнения для закрепления

1. `vi` чаще всего используется в качестве редактора файлов конфигурации и исходного кода, где отступы помогают идентифицировать разделы текста. Выделение можно сдвинуть влево, нажав `<`, и вправо, нажав `>`. Какие клавиши следует нажимать в обычном режиме, чтобы сдвинуть текущий выделенный фрагмент на три шага влево? 

2. Целую строку можно выбрать, нажав `V` в обычном режиме `vi`. Однако также включается завершающий символ новой строки. Какие клавиши следует нажимать в обычном режиме, чтобы выбрать от начального символа до символа новой строки, но не включая его? 

3. Как следует выполнить `vi` в командной строке, чтобы открыть `~/.bash_profile` и перейти прямо к последней строке? 

4. Какие клавиши следует нажимать в обычном режиме `vi`, чтобы удалить символы с текущей позиции курсора до следующего символа точки?


# Упражнения на размышление

1. `vim` позволяет выделять блоки текста произвольной ширины, а не только разделы с целыми строками. При нажатии <kbd>Ctrl</kbd>+<kbd>V</kbd> в обычном режиме выбор осуществляется перемещением курсора вверх, вниз, влево и вправо. Как с помощью этого метода удалить блок, начинающийся с первого символа в текущей строке, содержащий следующие восемь столбцов и пять строк текста? 

2. Сеанс `vi` был прерван из-за непредвиденного сбоя питания. При повторном открытии файла `vi` предлагает пользователю восстановить файл подкачки (автоматическая копия, сделанная `vi`). Что должен сделать пользователь, чтобы отказаться от файла подкачки? 

3. В сеансе `vim` строка ранее была скопирована в регистр `l`. Какая комбинация клавиш будет записывать макрос в регистр `a`, чтобы вставить строку в регистр `l` непосредственно перед текущей строкой?


# Резюме

В этом уроке рассматривается стандартный текстовый редактор для среды оболочки Linux: редактор `vi`. Несмотря на то, что `vi` пугает незнакомого пользователя, он имеет функции, которые делают его хорошим выбором для технического и нетехнического редактирования текста. Урок состоит из следующих этапов: 

* базовое использование `vi` и полезные функции. 
* Что такое `vim` - улучшенный `vi` - и другие альтернативные редакторы. 
* Как определить текстовый редактор по умолчанию для среды оболочки. 

Были рассмотрены следующие команды и процедуры: 

* Редактор `vi` и его улучшенная версия `vim`. 
* Базовое редактирование текста в `vi`. 
* Альтернативные редакторы `emacs` и `nano`.


# Ответы на упражнения для закрепления

1. `vi` чаще всего используется в качестве редактора файлов конфигурации и исходного кода, где отступы помогают идентифицировать разделы текста. Выделение можно сдвинуть влево, нажав `<`, и вправо, нажав `>`. Какие клавиши следует нажимать в обычном режиме, чтобы сдвинуть текущий выделенный фрагмент на три шага влево? 

2. Целую строку можно выбрать, нажав `V` в обычном режиме `vi`. Однако также включается завершающий символ новой строки. Какие клавиши следует нажимать в обычном режиме, чтобы выбрать от начального символа до символа новой строки, но не включая его? 

3. Как следует выполнить `vi` в командной строке, чтобы открыть `~/.bash_profile` и перейти прямо к последней строке? 

4. Какие клавиши следует нажимать в обычном режиме `vi`, чтобы удалить символы с текущей позиции курсора до следующего символа точки?


# Ответы на упражнения для размышления

1. `vim` позволяет выделять блоки текста произвольной ширины, а не только разделы с целыми строками. При нажатии <kbd>Ctrl</kbd>+<kbd>V</kbd> в обычном режиме выбор осуществляется перемещением курсора вверх, вниз, влево и вправо. Как с помощью этого метода удалить блок, начинающийся с первого символа в текущей строке, содержащий следующие восемь столбцов и пять строк текста? 

2. Сеанс `vi` был прерван из-за непредвиденного сбоя питания. При повторном открытии файла `vi` предлагает пользователю восстановить файл подкачки (автоматическая копия, сделанная `vi`). Что должен сделать пользователь, чтобы отказаться от файла подкачки? 

3. В сеансе `vim` строка ранее была скопирована в регистр `l`. Какая комбинация клавиш будет записывать макрос в регистр `a`, чтобы вставить строку в регистр `l` непосредственно перед текущей строкой?
