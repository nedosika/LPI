# 103.5 Урок 2

| Сертификат:   | LPIC-1                                      |
|:--------------|:--------------------------------------------|
| Версия:       | 5.0                                         |
| Тема:         | 103 GNU и Unix комманды                     |                           
| Цель:         | 103.5 Создание, мониторинг и завершение процессов |
| Урок:         | 2 из 2                                      |


# Введение

Инструменты и утилиты, рассмотренные в предыдущем уроке, очень полезны для мониторинга процессов в целом. Однако системному администратору, возможно, придется пойти еще дальше. В этом уроке мы обсудим концепцию терминальных мультиплексоров и узнаем о *GNU Screen* и *tmux*, поскольку, несмотря на современные и прекрасные терминальные эмуляторы, мультиплексоры по-прежнему сохраняют некоторые интересные, мощные функции для продвинутого системного администратора.


# Особенности терминальных мультиплексоров

В электронике мультиплексор (или `mux`) - это устройство, которое позволяет подключать несколько входов к одному выходу. Таким образом, оконечный мультиплексор дает нам возможность переключаться между различными входами по мере необходимости. Хотя это и не совсем то же самое, но экран и `tmux` имеют ряд общих функций: 

* Любой успешный вызов приведет как минимум к сеансу, который, в свою очередь, будет включать как минимум окно. Окна содержат программы. 
* Окна можно разделить на области или панели, что может повысить производительность при одновременной работе с различными программами. 
* Легкость управления: для запуска большинства команд используется комбинация клавиш - так называемый префикс команды или командная клавиша - за которым следует другой символ. 
* Сеансы можно отключать от текущего терминала (то есть программы отправляются в фоновый режим и продолжают работать). Это гарантирует полное выполнение программ, независимо от закрытия терминала, зависания или потери удаленного соединения. 
* Подключение к сокету. 
* Режим копирования. 
* Они легко настраиваются.


# GNU Screen

В ранние годы Unix (1970-1980-е) компьютеры в основном состояли из терминалов, подключенных к центральному компьютеру. Это все, никаких окон или вкладок. И это стало причиной создания *GNU Screen* в 1987 году: эмуляция нескольких независимых *VT100 экранов* на одном физическом терминале.


# Окна

GNU Screen вызывается простым вводом `screen` в терминал. Сначала вы увидите приветственное сообщение:
```console
GNU Screen version 4.05.00 (GNU) 10-Dec-16

Copyright (c) 2010 Juergen Weigert, Sadrul Habib Chowdhury
Copyright (c) 2008, 2009 Juergen Weigert, Michael Schroeder, Micah Cowan, Sadrul Habib Chowdhury
Copyright (c) 1993-2002, 2003, 2005, 2006, 2007 Juergen Weigert, Michael Schroeder
Copyright (c) 1987 Oliver Laumann
(...)
```
Нажмите <kbd>Пробел</kbd> или <kbd>Enter</kbd>, чтобы закрыть сообщение, и вам будет показана командная строка:
```console
$
```
Может показаться, что ничего не произошло, но факт в том, что `screen` уже создал и управляет своим первым сеансом и окном. Префикс команды экрана - <kbd>Ctrl</kbd>+<kbd>a</kbd>. Чтобы увидеть все окна в нижней части дисплея терминала, введите <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>w</kbd>:
```console
0*$ bash
```
Вот оно, наше пока единственное окно! Обратите внимание, что счет начинается с `0`. Чтобы создать другое окно, введите <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>c</kbd>. Вы увидите новую подсказку. Давайте запустим `ps` в этом новом окне:
```console
$ ps
  PID TTY          TIME CMD
  974 pts/2    00:00:00 bash
  981 pts/2    00:00:00 ps
```
и снова введите <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>w</kbd>:
```console
0-$ bash  1*$ bash
```
Здесь у нас есть два окна (обратите внимание на звездочку, указывающую на то, что отображается в данный момент). Однако, поскольку они были начаты с Bash, им обоим дано одно и то же имя. Поскольку мы вызвали `ps` в нашем текущем окне, давайте переименуем его с тем же именем. Для этого вам нужно набрать <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>A</kbd> и при появлении запроса написать новое имя окна (`ps`):
```console
Set window's title to: ps
```
Теперь давайте создадим еще одно окно, но с самого начала дадим ему имя: `yetanotherwindow`. Это делается путем вызова `screen` с ключом `-t`:
```console
$ screen -t yetanotherwindow
```
Перемещаться между окнами можно разными способами: 
* Используя <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>n</kbd> (перейти к следующему окну) и <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>p</kbd> (перейти к предыдущему окну). 
* Используя <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>номер</kbd> (перейти к номеру окна). Используя <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>"</kbd>, чтобы увидеть список всех окон. 
* Вы можете перемещаться вверх и вниз с помощью клавиш со стрелками и выбрать то, которое вы хотите, с помощью <kbd>Enter</kbd>:
```console
Num Name                                                Flags

   0 bash                                                   $
   1 ps                                                     $
   2 yetanotherwindow
```
При работе с окнами важно помнить следующее: окна запускают свои программы совершенно независимо друг от друга. Программы будут продолжать работать, даже если их окно не отображается (также, когда сеанс экрана отключен, как мы вскоре увидим). Чтобы удалить окно, просто завершите программу, работающую в нем (как только последнее окно будет удалено, `screen` завершит свою работу). Или используйте <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>k</kbd> в окне, которое вы хотите удалить; вас попросят подтвердить:
```console
Really kill this window [y/n]

Window 0 (bash) killed.
```


# Области (Regions)

`screen` может разделить экран терминала на несколько областей для размещения окон. Это разделение может быть горизонтальным (<kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>S</kbd>) или вертикальным (<kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>|</kbd>). Единственное, что будет отображаться в новом регионе, это  `--` внизу, что означает, что он пуст:
```console
1 ps                                                               --
```
Чтобы перейти в новую область, введите <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>Tab</kbd>. Теперь вы можете добавить окно любым из методов, которые мы уже видели, например: <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>2</kbd>. Теперь `--` должно было превратиться в `2 yetanotherwindow`:
```console
$ ps                                                  $
  PID TTY          TIME CMD
 1020 pts/2    00:00:00 bash
 1033 pts/2    00:00:00 ps
$ screen -t yetanotherwindow




   1 ps                                                                2 yetanotherwindow
```
При работе с областями следует учитывать следующие важные аспекты: 
* Вы перемещаетесь между областями, нажимая <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>Tab</kbd>. 
* Вы можете завершить все области, кроме текущего, с помощью <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>Q</kbd>. Вы можете завершить текущую область с помощью <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>X</kbd>. 
* Завершение области не завершает связанное с ней окно.


# Сессии

До сих пор мы играли с несколькими окнами и областями, но все они принадлежали одной и той же сессии. Пора начать играть с сессиями. Чтобы увидеть список всех сеансов, введите `screen -list` или `screen -ls`:
```console
$ screen -list
There is a screen on:
        1037.pts-0.debian       (08/24/19 13:53:35)     (Attached)
1 Socket in /run/screen/S-carol.
```
На данный момент это наша единственная сессия: 
* `PID`   
1037 
* `Name`  
pts-0.debian (с указанием терминала - в нашем случае подчиненного псевдотерминала - и имени хоста). 
`Status`  
`Attached` 

Давайте создадим новый сеанс, дав ему более описательное имя:
```console
$ screen -S "second session"
```
Дисплей терминала очистится, и вам будет предложено новое приглашение. Вы можете проверить наличие сеансов еще раз:
```console
$ screen -ls
There are screens on:
        1090.second session     (08/24/19 14:38:35)     (Attached)
        1037.pts-0.debian       (08/24/19 13:53:36)     (Attached)
2 Sockets in /run/screen/S-carol.
```
Чтобы завершить сеанс, закройте все его окна или просто введите команду `screen -S SESSION-PID -X quit` (вместо этого вы также можете указать имя сеанса). Избавимся от нашей первой сессии:
```console
$ screen -S 1037 -X quit
```
Вы будете отправлены обратно в окно терминала за пределами экрана. Но помните, что наша вторая сессия все еще жива:
```console
$ screen -ls
There is a screen on:
	1090.second session	(08/24/19 14:38:35)	(Detached)
1 Socket in /run/screen/S-carol.
```
Однако, поскольку мы уничтожили его родительский сеанс, ему присвоен новый ярлык: `Detached`.


## Отключаемая сессия

По ряду причин вы можете захотеть отключить сессию от ее терминала: 
* Чтобы позволить вашему компьютеру на работе делать свои дела и подключаться удаленно позже из дома. 
* Чтобы поделиться сессией с другими пользователями. 

Вы можете отключить сесию с помощью комбинации клавиш <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>d</kbd>. При этом вы вернетесь в свой терминал:
```console
[detached from 1090.second session]
$
```
Чтобы снова подключиться к сессии, используйте команду `screen -r SESSION-PID`. В качестве альтернативы вы можете использовать параметр `SESSION-NAME`, как мы видели выше. Если существует только одна сессия, то ни один из параметров не является обязательным:
```console
$ screen -r
```
Этой команды достаточно, чтобы повторно подключиться к нашей сессии повторно:
```console
$ screen -ls
There is a screen on:
        1090.second session      (08/24/19 14:38:35)     (Attached)
1 Socket in /run/screen/S-carol.
```
Важные параметры для повторного подключения к сессии:
* `-d -r`  
Повторно подключается к сессии и, если необходимо, сначала отключается от нее. 
* `-d -R`  
То же, что и `-d -r`, но `screen` сначала создаст сессию, если она не существует.
* `-d -RR`  
То же, что и `-d -R`. Однако использует первую сессию, если доступно более одной сессии. 
* `-D -r`  
Повторно подключает сессию. При необходимости сначала отключает и выходит из системы удаленно. 
* `-D -R`  
Если сессия запущена, подключается повторно (при необходимости сначала отключает и выходит из системы удаленно). Если она не запущена, создает его и уведомляет пользователя. 
* `-D -RR`  
То же, что и `-D -R` - только сильнее. 
* `-d -m`  
Стартовый экран в автономном режиме. Он создает новую сессию, но не подключается к ней. Это полезно для сценариев запуска системы. 
* `-D -m` То же, что и `-d -m`, но не разветвляет новый процесс. Команда завершается, если сессия завершится. 

Прочтите страницы руководства для `screen`, чтобы узнать о других возможностях.


## Копирование и вставка: режим прокрутки

*Screen GNU* имеет режим копирования или прокрутки. После ввхода вы можете перемещать курсор в текущем окне или по содержимому его истории с помощью клавиш со стрелками. Вы можете помечать и копировать текст в окнах. Для этого следует: 
* Войти в режим копирования/прокрутки: <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>[</kbd>. 
* Переместиться в начало фрагмента текста, который вы хотите скопировать, с помощью клавиш со стрелками. Отметьте начало фрагмента текста, который вы хотите скопировать: <kbd>Пробел</kbd>. 
* Переместиться в конец фрагмента текста, который вы хотите скопировать, с помощью клавиш со стрелками. Отметьте конец фрагмента текста, который вы хотите скопировать: <kbd>Пробел</kbd>.
* Перейти в выбранное вами окно и вставить фрагмент текста: <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>]</kbd>.

## Настройка экрана

Общесистемным файлом конфигурации для экрана является `/etc/screenrc`. В качестве альтернативы можно использовать настройки на уровне пользователя `~/.screenrc`. Файл включает четыре основных раздела конфигурации: 

* `SCREEN SETTINGS`  
Вы можете определить общие настройки, указав директиву, за которой следует пробел и значение, как в: `defscrollback 1024`. 
* `SCREEN KEYBINDINGS`  
Этот раздел весьма интересен, поскольку позволяет вам переопределить сочетания клавиш, которые могут мешать повседневному использованию терминала. Используйте ключевое слово `bind`, за которым следует пробел, символ, который следует использовать после префикса команды, еще один пробел и команду, например: `bind l kill` (этот параметр изменит способ закрытия окна по умолчанию на <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>l</kbd>). 

Чтобы отобразить все привязки экрана, введите <kbd>Ctrl</kbd>+<kbd>a</kbd>-<kbd>?</kbd> или обратитесь к странице руководства. 

>Конечно, вы также можете изменить сам префикс команды. Например, чтобы перейти от <kbd>Ctrl</kbd>+<kbd>a</kbd> к <kbd>Ctrl</kbd>+<kbd>b</kbd>, просто добавьте эту строку: `escape ^ Bb`.
 
* `TERMINAL SETTINGS`  
Этот раздел включает в себя настройки, связанные, среди прочего, с размерами окон терминала и буферами. Например, чтобы включить неблокирующий режим, чтобы лучше справляться с нестабильными ssh-соединениями, используется следующая конфигурация: `defnonblock 5`. 
* `STARTUP SCREENS`  
Вы можете включать команды для запуска различных программ при запуске экрана; например: `screen -t top top` (экран откроет окно с именем "top" с `top` внутри).


# tmux

`tmux` был выпущен в 2007 году. Хотя он очень похож на `screen`, он имеет несколько заметных отличий: 
* Модель клиент-сервер: сервер предоставляет несколько сеансов, каждый из которых может иметь несколько окон, связанных с ним, которые, в свою очередь, могут использоваться различными клиентами. 
* Интерактивный выбор сеансов, окон и клиентов через меню. 
* Одно и то же окно можно связать с несколькими сеансами. 
* Доступность раскладок клавиш как `vim`, так и `Emacs`. Поддержка UTF-8 и 256-цветного терминала.


## Окна

`tmux` можно вызвать, просто набрав `tmux` в командной строке. Вам будет показано приглашение оболочки и строка состояния внизу окна:
```
[0] 0:bash*                                                        "debian" 18:53 27-Aug-19
```
Помимо `hostname`, времени и даты, в строке состояния отображается следующая информация:
* Название сессии  
`[0]` 
* Номер окна  
`0:` 
* Имя окна  
`bash *`. По умолчанию это имя программы, запущенной внутри окна, и, в отличие от `screen`, `tmux` автоматически обновит его, чтобы отразить текущую запущенную программу. Обратите внимание на звездочку, указывающую, что это текущее видимое окно. 

Вы можете назначить имена сеансу и окну при вызове `tmux`:
```console
$ tmux new -s "LPI" -n "Window zero"
```
Строка состояния изменится соответственно:
```console
[LPI] 0:Window zero*                                                 "debian" 19:01 27-Aug-19
```
Префикс команды `tmux` - <kbd>Ctrl</kbd>+<kbd>b</kbd>. Чтобы создать новое окно, просто введите <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>c</kbd>; вы перейдете к новому запросу, и в строке состояния отобразится новое окно:
```console
[LPI] 0:Window zero- 1:bash*                                         "debian" 19:02 27-Aug-19
```
Поскольку Bash является базовой оболочкой, новому окну по умолчанию дается это имя. Начните сверху и посмотрите, как имя меняется на `top`:
```console
[LPI] 0:Window zero- 1:top*                                         "debian" 19:03 27-Aug-19
```
В любом случае вы можете переименовать окно с помощью <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>,</kbd>. При появлении запроса введите новое имя и нажмите <kbd>Enter</kbd>:
```console
(rename-window) Window one
```
Вы можете отобразить все окна для выбора с помощью <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>w</kbd> (используйте клавиши со стрелками для перемещения вверх и вниз и введите для выбора):
```console
(0)  0: Window zero- "debian"
(1)  1: Window one* "debian"
```
Подобно экрану, мы можем переходить из одного окна в другое с помощью: <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>n</kbd> перейти к следующему окну. <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>p</kbd> перейти к предыдущему окну. <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>число</kbd> перейти к номеру окна. Чтобы избавиться от окна, используйте <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>&</kbd>. Вам будет предложено подтвердить:
```console
kill-window Window one? (y/n)
```
К другим интересным оконным командам относятся:
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>f</kbd>  
найти окно по имени. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>.</kbd>  
изменить порядковый номер окна. 

Чтобы прочитать весь список команд, обратитесь к странице руководства.

## Панели

Средство разделения экрана `screen` также присутствует в `tmux`. Однако полученные подразделения не называются областями, а панелями. Наиболее важное различие между областями и панелями состоит в том, что последние представляют собой полные псевдотерминалы, связанные с окном. Это означает, что уничтожение панели также приведет к уничтожению ее псевдотерминала и всех связанных с ним программ, работающих внутри. Чтобы разделить окно по горизонтали, мы используем <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>"</kbd>:
```console
Tasks:  93 total,   1 running,  92 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  4050960 total,  3730920 free,   114880 used,   205160 buff/cache
KiB Swap:  4192252 total,  4192252 free,        0 used.  3716004 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
 1340 carol     20   0   44876   3400   2800 R  0.3  0.1   0:00.24 top
    1 root      20   0  139088   6988   5264 S  0.0  0.2   0:00.50 systemd
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd
    3 root      20   0       0      0      0 S  0.0  0.0   0:00.04 ksoftirqd/0
    4 root      20   0       0      0      0 S  0.0  0.0   0:01.62 kworker/0:0
    5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H
    7 root      20   0       0      0      0 S  0.0  0.0   0:00.06 rcu_sched
    8 root      20   0       0      0      0 S  0.0  0.0   0:00.00 rcu_bh
    9 root      rt   0       0      0      0 S  0.0  0.0   0:00.00 migration/0
   10 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 lru-add-drain
   11 root      rt   0       0      0      0 S  0.0  0.0   0:00.01 watchdog/0
   12 root      20   0       0      0      0 S  0.0  0.0   0:00.00 cpuhp/0
$
───────────────────────────────────────────────────────────────────────────────────────────────
$












[LPI] 0:Window zero- 1:Window one*                                      "debian" 19:05 27-Aug-19
```
Чтобы разделить его по вертикали, используйте <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>%</kbd>:
```console
                                                                            │$
    1 root      20   0  139088   6988   5264 S  0.0  0.2   0:00.50 systemd     │
                                                                               │
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd    │
                                                                               │
    3 root      20   0       0      0      0 S  0.0  0.0   0:00.04 ksoftirqd/0 │
    4 root      20   0       0      0      0 S  0.0  0.0   0:01.62 kworker/0:0 │
    5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H│
    7 root      20   0       0      0      0 S  0.0  0.0   0:00.06 rcu_sched   │
    8 root      20   0       0      0      0 S  0.0  0.0   0:00.00 rcu_bh      │
    9 root      rt   0       0      0      0 S  0.0  0.0   0:00.00 migration/0 │
                                                                               │
   10 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 lru-add-drai│
n                                                                              │
   11 root      rt   0       0      0      0 S  0.0  0.0   0:00.01 watchdog/0  │
                                                                               │
   12 root      20   0       0      0      0 S  0.0  0.0   0:00.00 cpuhp/0     │
                                                                               │
$                                                                              │
───────────────────────────────────────────────────────────────────────────────┴───────────────
$















[LPI] 0:Window zero- 1:Window one*                                      "debian" 19:05 27-Aug-19
```
Чтобы уничтожить текущую панель (вместе с псевдотерминалом, работающим в ней, вместе со всеми связанными программами), используйте <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>x</kbd>. Вам будет предложено подтвердить в строке состояния:
```consoleconsole
kill-pane 1? (y/n)
```
Важные команды панели: 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>↑</kbd>, <kbd>↓</kbd>, <kbd>←</kbd>, <kbd>→</kbd>  
перемещаться между панелями. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>;</kbd>  
перейти к последней активной панели. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>Ctrl</kbd>+<kbd>arrow key</kbd>  
изменить размер панели на одну строку. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>Alt</kbd>+<kbd>arrow key</kbd>  
изменить размер панели на пять строк. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>{</kbd>  
поменять местами панели (текущие на предыдущие). 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>}</kbd>  
поменять местами панели (с текущей на следующую). 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>z</kbd>  
увеличить/уменьшить панель.
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>t</kbd>  
`tmux` отображает на панели причудливые часы (убейте их, нажав <kbd>q</kbd>). 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>!</kbd>  
превратить панель в окно. 

Чтобы прочитать весь список команд, обратитесь к странице руководства.


# Сессии

Чтобы просмотреть сеансы в tmux, вы можете использовать <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>s</kbd>:
```console
(0) + LPI: 2 windows (attached)
```
В качестве альтернативы вы можете использовать команду `tmux ls`:
```console
$ tmux ls
LPI: 2 windows (created Tue Aug 27 19:01:49 2019) [158x39] (attached)
```
Есть только один сеанс (LPI), который включает в себя два окна. Давайте создадим новый сеанс из нашего текущего сеанса. Этого можно добиться, нажав <kbd>Ctrl</kbd>+<kbd>b</kbd>, введите в командной строке `:new` и нажмите <kbd>Enter</kbd>. Вы будете отправлены в новый сеанс, что можно увидеть в строке состояния:
```console
[2] 0:bash*                                                       "debian" 19:15 27-Aug-19
```
По умолчанию tmux назвал сеанс `2`. Чтобы переименовать его, используйте <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>$</kbd>. При появлении запроса введите новое имя и нажмите <kbd>Enter</kbd>:
```console
(rename-session) Second Session
```
Вы можете переключать сеансы с помощью <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>s</kbd> (используйте клавиши со стрелками и <kbd>enter</kbd>):
```console
(0) + LPI: 2 windows
(1) + Second Session: 1 windows (attached)
```
Чтобы убить сеанс, вы можете использовать команду `tmux kill-session -t SESSION-NAME`. Если вы введете команду в текущем подключенном сеансе, вы выйдете из `tmux` и вернетесь к исходному сеансу терминала:
```console
$ tmux kill-session -t "Second Session"
[exited]
$
```

## Отключенный сеанс

Завершив вторую сессию, мы оказались вне `tmux`. Однако у нас все еще есть активная сессия. Спросите у `tmux` список сессий, и вы обязательно найдете его там:
```console
$ tmux ls
LPI: 2 windows (created Tue Aug 27 19:01:49 2019) [158x39]
```
Однако этот сеанс отключен от своего терминала. Мы можем прикрепить его с помощью `tmux attach -t SESSION-NAME` (attach можно заменить на at или - просто - a). Когда есть только один сеанс, указание имени необязательно:
```console
$ tmux a
```
Теперь вы вернулись к сеансу; чтобы оторваться от него, нажмите <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>d</kbd>:
```console
[detached (from session LPI)]
$
```
>Один и тот же сеанс можно подключить к нескольким терминалам. Если вы хотите присоединить сеанс, убедившись, что он сначала отсоединен от любых других терминалов, используйте ключ `-d`: `tmux attach -d -t SESSION-NAME`.

Важные команды для присоединения/отсоединения сеанса:
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>D</kbd>  
выберите, какого клиента отсоединить. 
* <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>r</kbd>  
обновите клиентский терминал. 

Чтобы прочитать весь список команд, обратитесь к странице руководства.


## Копирование и вставка: режим прокрутки

`tmux` также имеет режим копирования в основном так же, как `screen` (не забудьте использовать префикс команды `tmux`, а не `screen`!). Единственное отличие в командном отношении состоит в том, что вы используете <kbd>Ctrl</kbd>+<kbd>Пробел</kbd>, чтобы отметить начало выделения, и <kbd>Alt</kbd>+<kbd>w</kbd>, чтобы скопировать выделенный текст.

## Настройка `tmux`

Файлы конфигурации для `tmux` обычно находятся в `/etc/tmux.conf` и `~/.tmux.conf`. При запуске `tmux` создает эти файлы, если они существуют. Также существует возможность запуска `tmux` с ключом `-f` для предоставления альтернативного файла конфигурации. Вы можете найти пример файла конфигурации `tmux`, расположенный в `/usr/share/doc/tmux/example_tmux.conf`. Уровень настройки, которого вы можете достичь, действительно высок. Вот некоторые из вещей, которые вы можете сделать:
* Измените префиксный ключ
```console
# Change the prefix key to C-a
set -g prefix C-a
unbind C-b
bind C-a send-prefix
```
* Установите дополнительные привязки клавиш для окон выше 9
```console
# Some extra key bindings to select higher numbered windows
bind F1 selectw -t:10
bind F2 selectw -t:11
bind F3 selectw -t:12
```

Чтобы получить полный список всех привязок, введите <kbd>Ctrl</kbd>+<kbd>b</kbd>-<kbd>?</kbd> (нажмите <kbd>q</kbd> для выхода) или обратитесь к странице руководства.

# Упражнения для закрепления

1. Укажите, соответствуют ли следующие операторы/функции GNU Screen, tmux или обоим:

| Функция/Оператор              | GNU Screen  | tmux          |
|:------------------------------|-------------|---------------|
| Префикс команды по умолчанию <kbd>Ctrl</kbd>+<kbd>a</kbd>  |
| Модель клиент-сервер          |           
| Панели это псевдотерминалы    |        
| Завершение области не уничтожает связанные с ней окна  |
| Сеансы включают окна          |       
| Сессии могут быть отключены   |         

2. Установите GNU Screen на свой компьютер (имя пакета: `screen`) и выполните следующие задачи: 
* Запустить программу. Какую команду вы используете? 
```
```
* Запустите `top`: 
```
```
* Используя префикс клавиши экрана, откройте новое окно; затем откройте `/etc/screenrc` с помощью `vi`: 
```
```
* Перечислите окна внизу экрана: 
```
```
* Измените имя текущего окна на `vi`: 
```
```
* Измените название оставшегося окна на `top`. Для этого сначала отобразите список всех окон, чтобы вы могли перемещаться вверх и вниз и выбирать нужное: 
```
```
* Убедитесь, что имена изменились, снова отобразив имена окон в нижней части экрана: 
```
```
* Теперь отключите сеанс и попросите `screen` создать новый с именем `ssh`: 
```
```
* Отключитесь также от `ssh` и отобразите на экране список сеансов: 
```
```
* Теперь подключитесь к первому сеансу, используя его PID: 
```
```
* Вы должны снова оказаться в верхней части окна. Разделите окно по горизонтали и перейдите в новую пустую область: 
```
```
* Отобразите список всех окон на экране и выберите `vi`, который будет отображаться в новой пустой области: 
```
```
* Теперь разделите текущую область по вертикали, перейдите во вновь созданную пустую область и свяжите ее с совершенно новым окном: 
```
```
* Завершить все регионы, кроме текущего (помните, что, хотя вы убиваете регионы, окна все еще живы). Затем выйдите из всех окон текущего сеанса, пока сам сеанс не будет завершен: 
```
```
* Наконец, еще раз просмотрите список своих сеансов на экране, завершите оставшийся сеанс `ssh` по `PID` и убедитесь, что на самом деле сеансов не осталось:
```
```

# Упражнения на размышление




# Резюме




# Ответы на упражнения для закрепления



# Ответы на упражнения для размышления
