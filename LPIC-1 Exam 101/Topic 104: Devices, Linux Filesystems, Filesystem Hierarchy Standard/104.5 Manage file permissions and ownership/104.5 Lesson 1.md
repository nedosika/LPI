# 104.1 Урок 1

| Сертификат:   | LPIC-1                                      |
|:--------------|:--------------------------------------------|
| Версия:       | 5                                           |
| Тема:         | 104 Устройства, файловые системы Linux, стандарт иерархии файловых систем |                           
| Цель:         | 104.5 Управление правами доступа к файлам |
| Урок:         | 1 из 1                                      |


# Введение

Будучи многопользовательской системой, Linux нужен какой-то способ отслеживать, кому принадлежит каждый файл и разрешено ли 
пользователю выполнять действия с файлом. Это необходимо для обеспечения конфиденциальности пользователей, которые могут 
захотеть сохранить конфиденциальность содержимого своих файлов, а также для обеспечения совместной работы, сделав определенные файлы доступными для нескольких пользователей.

Это делается через трехуровневую систему прав. Каждый файл на диске принадлежит пользователю и группе пользователей и 
имеет три набора разрешений: один для своего владельца, один для группы, которая владеет файлом, и один для всех остальных. 
В этом уроке вы узнаете, как вывести на экран права доступа к файлам, значение этих прав и как ими управлять.


# Запрос информации о файлах и каталогах

Команда `ls` используется для получения списка содержимого любого каталога. В этой базовой форме вы получаете только имена 
файлов:
```
$ ls
Another_Directory  picture.jpg  text.txt
```
Но для каждого файла доступно гораздо больше информации, включая его тип, размер, владельца и многое другое. Чтобы увидеть 
эту информацию, вы должны запросить у `ls` «длинный» листинг, используя параметр `-l`:
```
$ ls -l
total 536
drwxrwxr-x 2 carol carol   4096 Dec 10 15:57 Another_Directory
-rw------- 1 carol carol 539663 Dec 10 10:43 picture.jpg
-rw-rw-r-- 1 carol carol   1881 Dec 10 15:57 text.txt
```
Каждый столбец в выходных данных выше имеет значение. Давайте посмотрим на столбцы, относящиеся к этому уроку.
* Первый *столбец* в листинге показывает тип файла и права доступа. Например, `на drwxrwxr-x`:
    * Первый символ `d` указывает тип файла.
    * Следующие три символа, `rwx`, указывают права доступа для владельца файла, также называемого `пользователем` или `u`.
    * Следующие три символа, `rwx`, указывают права доступа для `группы`, владеющей файлом, также называемой `g`.
    * Последние три символа, `r-x`, обозначают права доступа для всех остальных, также известных как `другие` или `o`.

>Также часто можно услышать, что `другие` права доступа называются правами для всего `мира`, например, «Все остальные в мире имеют эти права доступа».

Во `втором` столбце указано количество жестких ссылок, указывающих на этот файл. `Пятый` столбец показывает размер файла. `Шестой` столбец показывает дату и время последнего изменения файла. Но эти столбцы не актуальны для текущей темы.


# А как насчет каталогов?

Если вы попытаетесь запросить информацию о каталоге с помощью `ls -l`, вместо этого он покажет вам список содержимого каталога:
```
$ ls -l Another_Directory/
total 0
-rw-r--r-- 1 carol carol 0 Dec 10 17:59 another_file.txt
```
Чтобы избежать этого и запросить информацию о самом каталоге, добавьте параметр `-d` в `ls`:
```
$ ls -l -d Another_Directory/
drwxrwxr-x 2 carol carol 4096 Dec 10 17:59 Another_Directory/
```


# Просмотр скрытых файлов

Список каталогов, который мы получили с помощью `ls -l` ранее, неполон:
```
$ ls -l
total 544
drwxrwxr-x 2 carol carol   4096 Dec 10 17:59 Another_Directory
-rw------- 1 carol carol 539663 Dec 10 10:43 picture.jpg
-rw-rw-r-- 1 carol carol   1881 Dec 10 15:57 text.txt
```
В этом каталоге есть еще три файла, но они скрыты. В Linux файлы, имена которых начинаются с точки (`.`), Автоматически скрываются. Чтобы увидеть их, нам нужно добавить параметр `-a` в `ls`:
```
$ ls -l -a
total 544
drwxrwxr-x 3 carol carol   4096 Dec 10 16:01 .
drwxrwxr-x 4 carol carol   4096 Dec 10 15:56 ..
drwxrwxr-x 2 carol carol   4096 Dec 10 17:59 Another_Directory
-rw------- 1 carol carol 539663 Dec 10 10:43 picture.jpg
-rw-rw-r-- 1 carol carol   1881 Dec 10 15:57 text.txt
-rw-r--r-- 1 carol carol      0 Dec 10 16:01 .thisIsHidden
```
Файл `.thisIsHidden` просто скрыт, потому что его имя начинается с `.`.

Директории `.` и `..` особенные. `.` указатель на текущий каталог. А `..` - это указатель на родительский каталог, в котором находится текущий. В Linux каждый каталог содержит по крайней мере эти два каталога.

>Вы можете комбинировать несколько параметров для `ls` (и многих других команд Linux). Например, `ls -l -a` можно записать как `ls -la`.


# Понимание типов файлов

Мы уже упоминали, что первая буква в каждом выводе `ls -l` описывает тип файла. Три наиболее распространенных типа файлов:

`-` (обычный файл)
>Файл может содержать данные любого типа и помогать управлять этими данными. Файлы можно изменять, перемещать, копировать и удалять.

`d` (каталог)
>Каталог содержит другие файлы или каталоги и помогает организовать файловую систему. Технически каталоги - это особый вид файлов.

`l` (символическая ссылка)
>Этот «файл» является указателем на другой файл или каталог в другом месте файловой системы.

В дополнение к ним есть еще три типа файлов, о которых вы должны хотя бы знать, но которые выходят за рамки этого урока:

`b` (блочное устройство)
>В дополнение к ним есть еще три типа файлов, о которых вы должны хотя бы знать, но которые выходят за рамки этого урока:

`c` (символьное устройство)
>Этот файл обозначает виртуальное или физическое устройство. Терминалы (например, основной терминал на ``/dev/ ttyS0) и последовательные порты являются типичными примерами символьных устройств.

`s` (сокет)
>Сокеты служат «проводниками» для передачи информации между двумя программами.

>Не изменяйте никакие разрешения для блочных устройств, символьных устройств или сокетов, если вы не знаете, что делаете. Это может помешать вашей системе работать!


# Понимание прав доступа

В выводе команды `ls -l` права доступа к файлу отображаются сразу после типа файла в виде трех групп по три символа в каждой в порядке `r`, `w` и `x`. Вот что они означают. Имейте в виду, что прочерк - это отсутствие разрешения.


# Права доступа на файлы

`r`
>Обозначает `чтение` и имеет восьмеричное значение `4` (не волнуйтесь, мы скоро обсудим восьмеричные числа). Это означает разрешение на открытие файла и чтение его содержимого.

`w`
>Обозначает `запись` и имеет восьмеричное значение `2`. Это означает разрешение на редактирование или удаление файла.

`x`
>Обозначает `выполнение` и имеет восьмеричное значение `1`. Это означает, что файл может быть запущен как исполняемый файл или сценарий.


# Права доступа на каталоги

`r`
>Обозначает `чтение` и имеет восьмеричное значение `4`. Это означает разрешение на чтение содержимого каталога, например имен файлов. Но это не означает разрешения на чтение самих файлов.

`w`
>Обозначает `запись` и имеет восьмеричное значение `2`. Это означает разрешение на создание или удаление файлов в каталоге или изменение их имен, разрешений и владельцев.

Если у пользователя есть разрешение `w` для каталога, он может изменять права доступа к любому файлу в каталоге (`содержимое` каталога), даже если у пользователя нет разрешений на этот файл или если файл принадлежит другому пользователю.

Имейте в виду, что наличие прав на запись в каталог или файл не означает, что у вас есть разрешение на удаление или переименование самого каталога или файла.

`x`
>Обозначает `выполнение` и имеет восьмеричное значение `1`. Это означает разрешение на вход в каталог, но не на перечисление его файлов (для этого требуется `r`).

Последнее о каталогах может показаться немного запутанным. Представим, например, что у вас есть каталог с именем `Another_Directory` со следующими разрешениями:
```
$ ls -ld Another_Directory/
d--x--x--x 2 carol carol 4,0K Dec 20 18:46 Another_Directory
```
Также представьте, что внутри этого каталога у вас есть сценарий оболочки с именем `hello.sh`:
```
-rwxr-xr-x 1 carol carol 33 Dec 20 18:46 hello.sh
```
Если вы пользователь `carol` и попытаетесь перечислить содержимое `Another_Directory`, вы получите сообщение об ошибке, так как у вашего пользователя нет прав на чтение для этого каталога:
```
$ ls -l Another_Directory/
ls: cannot open directory 'Another_Directory/': Permission denied
```
Однако у пользователя `carol` есть разрешения на выполнение, что означает, что она может войти в каталог. Следовательно, пользователь `carol` может получить доступ к файлам внутри каталога, если у нее есть правильные разрешения для соответствующего файла. Предположим, у пользователя есть полные права доступа (rwx) для скрипта `hello.sh`. Затем она может запустить сценарий, даже если она не может прочитать содержимое каталога, в котором он находится, если ей известно полное имя файла:
```
$ sh Another_Directory/hello.sh
Hello LPI World!
```
Как мы уже говорили ранее, разрешения указываются последовательно: сначала для владельца файла, затем для группы-владельца, а затем для других пользователей. Всякий раз, когда кто-то пытается выполнить действие с файлом, разрешения проверяются таким же образом.

Сначала система проверяет, является ли текущий пользователь владельцем файла, если да, то применяет только первый набор прав. В противном случае он проверяет, принадлежит ли текущий пользователь к группе, владеющей файлом. В этом случае применяется только второй набор прав доступа. В любом другом случае система применит третий набор прав.

Это означает, что если текущий пользователь является владельцем файла, действуют только права доступа владельца, даже если права группы или другие права более высокие, чем права владельца.


# Изменение прав доступа к файлам

