# 104.7 Урок 1

| Сертификат:   | LPIC-1                                      |
|:--------------|:--------------------------------------------|
| Версия:       | 5                                           |
| Тема:         | 104 Устройства, файловые системы Linux, стандарт иерархии файловых систем |                           
| Цель:         | 104.7 Поиск системных файлов и правильное их местоположение |
| Урок:         | 1 из 1                                      |


# Введение

Дистрибутивы Linux бывают самых разных форм и размеров, но почти всех их объединяет то, что они следуют Стандарту иерархии файловой системы (FHS), который определяет «стандартную структуру» для файловой системы, значительно упрощая взаимодействие и системное администрирование. В этом уроке вы узнаете больше об этом стандарте и о том, как искать файлы в системе Linux


# Стандарт иерархии файловой системы

Стандарт иерархии файловой системы (FHS) - это попытка Linux Foundation стандартизировать структуру каталогов и их содержимое в системах Linux. Соответствие стандарту не является обязательным, но большинство дистрибутивов следуют ему.

>Те, кто интересуется деталями организации файловой системы, могут прочитать спецификацию FHS 3.0, доступную в нескольких форматах по адресу: http://refspecs.linuxfoundation.org/fhs.shtml

Согласно стандарту, основная структура каталогов следующая:

`/`
>Это корневой каталог, самый верхний каталог в иерархии. Все остальные каталоги находятся внутри него. Файловую систему часто сравнивают с «деревом», так что это будет «ствол», к которому подключены все ветви.

`/bin`
>Основные бинарные файлы, доступные всем пользователям.

`/boot`
>Файлы, необходимые для процесса загрузки, включая начальный RAM-диск (initrd) и само ядро Linux.

`/dev`
>Файлы устройств. Это могут быть либо физические устройства, подключенные к системе (например, `/dev/sda` будет первым диском SCSI или SATA), либо виртуальные устройства, предоставляемые ядром.

`/etc`
>Файлы конфигураций системных утилит. При необходимости программы могут создавать подкаталоги в `/etc` для хранения нескольких файлов конфигурации.

`home`
>У каждого пользователя в системе есть «домашний» каталог для хранения личных файлов и настроек, и большинство из них находится в `/home`. Обычно домашний каталог совпадает с именем пользователя, поэтому у пользователя John будет его каталог в `/home/john`. Исключение составляют суперпользователь(root), у которого есть отдельный каталог (`/root`), и некоторые системные пользователи.

`/lib`
>Общие библиотеки, необходимые для загрузки операционной системы и запуска двоичных файлов в `/bin` и `/sbin`.

`/media`
>Сюда монтируются сменные носители, монтируемые пользователем, такие как флэш-накопители, устройства чтения компакт-дисков и DVD-ROM, гибкие диски, карты памяти и внешние диски.

`/mnt`
>Точка монтирования для временно смонтированных файловых систем.

`/opt`
>Пакеты прикладного программного обеспечения.

`/root`
>Домашний каталог суперпользователя (root).

`/run`
>Данные переменных времени выполнения.

`/sbin`
>Системные двоичные файлы.

`/srv`
>Данные, обслуживаемые системой. Например, страницы, обслуживаемые веб-сервером, могут храниться в `/srv/www`.

`/tmp`
>Временные файлы.

`/usr`
>Доступные только для чтения пользовательские данные, включая данные, необходимые некоторым вторичным утилитам и приложениям.

`/proc`
>Виртуальная файловая система, содержащая данные, относящиеся к запущенным процессам.

`/var`
>Изменяемые данные, записываемые во время работы системы, включая очередь печати, данные журнала, почтовые ящики, временные файлы, кеш браузера и т. д.

Имейте в виду, что некоторые из этих каталогов, например `/etc`, `/usr` и `/var`, содержат целую иерархию подкаталогов внутри них.


# Поиск файлов

Для поиска файлов в системе Linux вы можете использовать команду `find`. Это очень мощный инструмент с множеством параметров, которые могут соответствовать его поведению и изменять вывод в точности в соответствии с вашими потребностями.

Для начала `find` нужны два аргумента: отправная точка и то, что искать. Например, для поиска всех файлов в текущем каталоге (и подкаталогах), имена которых оканчиваются на `.jpg`, вы можете использовать:
```
$ find . -name '*.jpg'
./pixel_3a_seethrough_1.jpg
./Mate3.jpg
./Expert.jpg
./Pentaro.jpg
./Mate1.jpg
./Mate2.jpg
./Sala.jpg
./Hotbit.jpg
```
Это будет соответствовать любому файлу, последние четыре символа имени которого являются .jpg, независимо от того, что стоит перед ним, поскольку * - это подстановочный знак для «чего угодно». Однако посмотрите, что произойдет, если в конце шаблона добавить еще один *:
```
$ find . -name '*.jpg*'
./pixel_3a_seethrough_1.jpg
./Pentaro.jpg.zip
./Mate3.jpg
./Expert.jpg
./Pentaro.jpg
./Mate1.jpg
./Mate2.jpg
./Sala.jpg
./Hotbit.jpg
```
Файл `Pentaro.jpg.zip`(выделенный выше) не был включен в предыдущий список, потому что, даже если он содержит `.jpg` в своем имени, он не соответствует шаблону, так как после него есть дополнительные символы.
>Имейте в виду, что параметр -name чувствителен к регистру. Если вы хотите выполнить поиск без учета регистра, используйте `-iname`.

Выражение `*.jpg` должно быть заключено в одинарные кавычки, чтобы оболочка не интерпретировала сам шаблон. Попробуйте без кавычек и посмотрите, что получится.

По умолчанию поиск начинается с начальной точки и спускается по всем найденным подкаталогам (и подкаталогам этих подкаталогов). Вы можете ограничить это поведение с помощью параметров `-maxdepth N`, где `N` - максимальное количество уровней.

Для поиска только в текущем каталоге вы должны использовать -maxdepth 1. Предположим, у вас есть следующая структура каталогов:
```
directory
├── clients.txt
├── partners.txt -> clients.txt
└── somedir
    ├── anotherdir
    └── clients.txt
```
Для поиска внутри `somedir` вам нужно будет использовать `-maxdepth 2` (текущий каталог на +1 уровень ниже). Для поиска внутри `anotherdir` потребуется `-maxdepth 3` (текущий каталог +2 уровня ниже). Параметр `-mindepth N` работает в обратном порядке, ища только в каталогах минимум на `N` уровней ниже.

Параметр `-mount` можно использовать, чтобы избежать падения внутри смонтированных файловых систем. Вы также можете ограничить поиск определенными типами файловых систем с помощью параметра `-fstype`. Итак, `find /mnt -fstype exfat -iname "*report*"` будет искать только внутри файловых систем exFAT, смонтированных в `/mnt`.


# Поиск по атрибутам

Вы можете использовать приведенные ниже параметры для поиска файлов с определенными атрибутами, такими как те, которые доступны для записи вашему пользователю, имеют определенный набор прав доступа или имеют определенный размер:

`-user USERNAME`
>Соответствует файлам, принадлежащим пользователю `USERNAME`.

`-group GROUPNAME`
>Соответствует файлам, принадлежащим группе `GROUPNAME`.

`-readable`
>Соответствует файлам, доступным для чтения текущему пользователю.

`-writable`
>Соответствует файлам, которые доступны для записи текущему пользователю.

`-executable`
>Соответствует файлам, которые исполняются текущим пользователем. В случае каталогов это будет соответствовать любому каталогу, в который может войти пользователь (разрешение `x`).

`-perm NNNN`
>Это будет соответствовать любым файлам, которые имеют точно разрешение `NNNN`. Например, `-perm 0664` будет соответствовать любым файлам, которые пользователь и группа могут читать и записывать, и которые могут читать другие (или `rw-rw-r--`).

Вы можете добавить `-` перед `NNNN`, чтобы проверять файлы, у которых есть права не менее чем указанные. Например, `-perm -644` будет соответствовать файлам с правами не менее `644` (`rw-r--r--`). Это включает файл с `664` (`rw-rw-r--`) или даже `775` (`rwxrwx-r-x`).

`-empty`
>Соответствует пустым файлам и каталогам.

`-size N`
>Соответствует любым файлам размером `N`, где `N` по умолчанию - количество блоков размером 512 байт. Вы можете добавлять суффиксы к `N` для других единиц: `Nc` будет считать размер в байтах, `Nk` в кибибайтах (KiB, кратные 1024 байтам), `NM` в мебибайтах (MiB, кратные 1024 * 1024) и `NG` для гибибайтов (GiB, кратные 1024 * 1024 * 1024).

Опять же, вы можете добавить префиксы `+` или `-` (здесь означают больше и меньше чем) для поиска относительных размеров. Например, `-size -10M` будет соответствовать любому файлу размером менее 10 МБ. 

Например, для поиска файлов в вашем домашнем каталоге, без учета регистра в любой части имени, имеют права 0644, были доступны 10 дней назад и размер которых составляет не менее 1 MB, вы можете использовать
```
$ find ~ -iname "*report*" -perm 0644 -atime 10 -size +1M
```


# Поиск по времени

Помимо поиска атрибутов, вы также можете выполнять поиск по времени, находя файлы, к которым осуществлялся доступ, их атрибуты были изменены или были изменены в течение определенного периода времени. Параметры следующие:

`-amin N`, `-cmin N`, `-mmin N`
>Это будет соответствовать файлам, к которым был осуществлен доступ, были изменены атрибуты или были изменены (соответственно) `N` минут назад.

`-atime N`, `-ctime N`, `-mtime N`
>Это будет соответствовать файлам, к которым был осуществлен доступ, были изменены атрибуты или были изменены `N*24` часа назад.

Для `-cmin N` и `-ctime N` любое изменение атрибута вызовет совпадение, включая изменение прав, чтение или запись в файл. Это делает эти параметры особенно мощными, поскольку практически любая операция с файлом вызовет совпадение.

Следующий пример соответствует любому файлу в текущем каталоге, который был изменен менее 24 часов назад и имеет размер более 100 МБ:
```
$ find . -mtime -1 -size +100M
```


# Использование `locate` и `updatedb`

