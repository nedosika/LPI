# 104.1 Урок 1

| Сертификат:   | LPIC-1                                      |
|:--------------|:--------------------------------------------|
| Версия:       | 5                                           |
| Тема:         | 104 устройства, файловые системы Linux, стандарт иерархии файловых систем |                           
| Цель:         | 104.1 Создание разделов и файловых систем   |
| Урок:         | 1 из 1                                      |


# Введение

В любой операционной системе перед использованием диск необходимо разбить на разделы.
Раздел - это логическое подмножество физического диска, и информация о разделах 
хранится в таблице разделов. Эта таблица включает информацию о первом и последнем 
секторах раздела и его типе, а также дополнительные сведения о каждом разделе.

Обычно каждый раздел рассматривается операционной системой как отдельный «диск», 
даже если все они находятся на одном физическом носителе. В системах Windows им 
присваиваются такие буквы, как `C:` (исторически основной диск), `D:` и так далее. В Linux
каждый раздел привязан к каталогу в `/dev`, например `/dev/sda1` или `/dev/sda2`.

В этом уроке вы узнаете, как создавать, удалять, восстанавливать и изменять размер
разделов с помощью трех наиболее распространенных утилит (fdisk, gdisk и parted), 
как создать на них файловую систему и как создать и настроить раздел подкачки или 
файл подкачки для использования в качестве виртуальной памяти.

>По историческим причинам в этом уроке мы будем называть носители данных «дисками», 
>хотя современные системы хранения, такие как твердотельные накопители и 
>флэш-накопители, вообще не содержат никаких «дисков».


# Понимание MBR и GPT

Есть два основных способа хранения информации о разделах на жестких дисках. Первый - 
это MBR (*Master Boot Record*), а второй - это GPT (*GUID Partition Table*).

MBR
Это пережиток первых дней MS-DOS (точнее, PC-DOS 2.0 с 1983 года) и на протяжении
десятилетий был стандартной схемой разделения на ПК. Таблица разделов хранится в 
первом секторе диска, называемом загрузочным сектором, вместе с загрузчиком, 
которым в системах Linux обычно является загрузчик GRUB. Но MBR имеет ряд 
ограничений, которые препятствуют его использованию в современных системах, 
например невозможность адресовать диски размером более 2 ТБ и ограничение в 4 
основных раздела на диск.

GPT
Система разделения, которая устраняет многие ограничения MBR. Практического 
ограничения на размер диска нет, а максимальное количество разделов ограничено 
только самой операционной системой. Это чаще встречается на более современных 
машинах, которые используют UEFI вместо старого BIOS ПК.

Во время задач системного администрирования весьма вероятно, что вы обнаружите, что обе схемы используются, поэтому важно знать, как использовать инструменты, связанные с каждой из них, для создания, удаления или изменения разделов.


# Управление разделами MBR с помощью FDISK

Стандартная утилита для управления разделами MBR в Linux - `fdisk`. Это интерактивная утилита с меню. Чтобы использовать его, введите `fdisk`, а затем имя устройства, соответствующего диску, который вы хотите редактировать. Например, команда
```
# fdisk /dev/sda
```
будет редактировать таблицу разделов первого устройства, подключенного к SATA (sda) в системе. Имейте в виду, что вам нужно указать устройство, соответствующее физическому диску, а не одному из его разделов (например, `/dev/sda1`).
>Все операции с дисками в этом уроке должны выполняться от имени пользователя root (системного администратора) или с правами root с помощью `sudo`.

При вызове fdisk покажет приветствие, затем предупреждение и будет ждать ваших команд.
```
# fdisk /dev/sda
Welcome to fdisk (util-linux 2.33.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Command (m for help):
```
Предупреждение важно. Вы можете создавать, редактировать или удалять разделы по своему желанию, но ничего не будет записано на диск, если вы не используете команду write (`w`). Таким образом, вы можете «практиковаться» без риска потери данных, пока не нажимаете клавишу `w`. Чтобы выйти из `fdis`k без сохранения изменений, используйте команду `q`.
>При этом никогда не следует практиковаться на важном диске, поскольку всегда есть риски. Вместо этого используйте запасной внешний диск или USB-накопитель.


# Вывод текущей таблицы разделов

Команда `p` используется для печати текущей таблицы разделов. Результат будет примерно таким:
```
Command (m for help): p
Disk /dev/sda: 111.8 GiB, 120034123776 bytes, 234441648 sectors
Disk model: CT120BX500SSD1
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x97f8fef5

Device     Boot     Start       End   Sectors   Size Id Type
/dev/sda1            4096 226048942 226044847 107.8G 83 Linux
/dev/sda2       226048944 234437550   8388607     4G 82 Linux swap / Solaris
```
Вот значение каждого столбца:
* `Device` - Устройство, назначенное разделу.
* `Boot` - Показывает, является ли раздел загрузочным.
* `Start` - Сектор, в котором начинается раздел.
* `End` - Сектор, в котором заканчивается раздел.
* `Sectors` - Общее количество секторов в разделе. Умножьте его на размер сектора, чтобы получить размер раздела в байтах.
* `Size` - Размер раздела в формате, удобном для чтения. В приведенном выше примере значения указаны в гигабайтах.
* `Id` - Числовое значение, представляющее тип раздела.
* `Type` - Описание типа раздела.


# Основной или расширеный разделы

На MBR-диске может быть 2 основных типа разделов: *primary* и *extended*. Как мы уже говорили, у вас может быть только 4 основных раздела на диске, и если вы хотите сделать диск «загрузочным», первый раздел должен быть основным. 

Один из способов обойти это ограничение - создать расширенный раздел, который действует как контейнер для *logical* разделов. У вас может быть, например, первичный раздел, расширенный раздел, занимающий оставшуюся часть дискового пространства, и пять логических разделов внутри него.

Для такой операционной системы, как Linux, первичные и расширенные разделы обрабатываются одинаково, поэтому нет «преимуществ» использования одного над другим.


# Создание раздела

Чтобы создать раздел, используйте команду `n`. По умолчанию разделы будут созданы в начале незанятого пространства на диске. Вам будет предложено указать тип раздела (основной или расширенный), первый и последний сектор.

Для первого сектора вы обычно можете принять значение по умолчанию, предложенное `fdisk`, если вам не нужен раздел, начинающийся с определенного сектора. Вместо того, чтобы указывать последний сектор, вы можете указать размер, за которым следуют буквы `K`, `M`, `G`, `T` или `P` (Kilo, Mega, Giga, Tera или Peta). Итак, если вы хотите создать раздел размером 1 GB, вы можете указать `+1GB` в качестве `Last sector` (последнего сектора), и `fdisk` изменит размер раздела соответствующим образом. См. Этот пример для создания основного раздела:
```
Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-3903577, default 2048): 2048
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-3903577, default 3903577): +1G
```


# Проверка на незанятое пространство

Если вы не знаете, сколько свободного места на диске, вы можете использовать команду `F`, чтобы показать нераспределенное пространство, например:
```
Command (m for help): F
Unpartitioned space /dev/sdd: 881 MiB, 923841536 bytes, 1804378 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes

  Start     End Sectors  Size
2099200 3903577 1804378  881M
```


# Удаление разделов

Чтобы удалить раздел, используйте команду `d`. `fdisk` спросит у вас номер раздела, который вы хотите удалить, если на диске нет только одного раздела. В этом случае этот раздел будет выбран и немедленно удален.

Имейте в виду, что если вы удалите расширенный раздел, все логические разделы внутри него также будут удалены.


# Обратите внимание на разрыв!

Имейте в виду, что при создании нового раздела с помощью fdisk максимальный размер будет ограничен максимальным объемом непрерывного нераспределенного пространства на диске. Скажем, например, что у вас есть следующая карта разделов:
```
Device     Boot   Start     End Sectors  Size Id Type
/dev/sdd1          2048 1050623 1048576  512M 83 Linux
/dev/sdd2       1050624 2099199 1048576  512M 83 Linux
/dev/sdd3       2099200 3147775 1048576  512M 83 Linux
```
Затем вы удаляете раздел 2 и проверяете наличие свободного места:
```
Command (m for help): F
Unpartitioned space /dev/sdd: 881 MiB, 923841536 bytes, 1804378 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes

  Start     End Sectors  Size
1050624 2099199 1048576  512M
3147776 3903577  755802  369M
```
Adding up the size of the unallocated space, in theory we have 881 MB available. But see what happens when we try to create a 700 MB partition:
```
Command (m for help): n
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (2,4, default 2): 2
First sector (1050624-3903577, default 1050624):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (1050624-2099199, default 2099199): +700M
Value out of range.
```
Это происходит потому, что наибольшее непрерывное незанятое пространство на диске - это блок размером 512 МБ, принадлежащий разделу 2. Ваш новый раздел не может «достучаться» до раздела 3, чтобы использовать часть нераспределенного пространства после него.


# Изменение типа раздела


